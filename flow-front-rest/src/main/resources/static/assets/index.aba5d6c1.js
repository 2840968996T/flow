var F=(e,t,n)=>new Promise((a,s)=>{var _=c=>{try{u(n.next(c))}catch(p){s(p)}},i=c=>{try{u(n.throw(c))}catch(p){s(p)}},u=c=>c.done?a(c.value):Promise.resolve(c.value).then(_,i);u((n=n.apply(e,t)).next())});import{B as ne,b as oe}from"./index.97cbc093.js";import{P as re}from"./index.ea98cb4e.js";import{m as f,r as S,L as ae,a as ie,bJ as le,b_ as se,C as R,v as C,aF as b,o as A,i as N,z as O,l as g,B as I,t as w,b0 as ue,f as ce,F as de,aI as pe,j as me,aG as fe,E as ge}from"./index.9720c7d6.js";import{T as ve}from"./index.4099e7a2.js";import{S as he}from"./index.341e151a.js";import{A as Oe}from"./index.1f70c282.js";import ye from"./index.93bc77b0.js";import{c as be,a as we,b as B,V as Me}from"./Viewer.ca2e1abd.js";import{j as _e,l as Ce,k as Pe}from"./process.af0f61c7.js";import"./useWindowSizeFn.6f018250.js";import"./FullscreenOutlined.64517815.js";import"./index.edeb2df7.js";import"./index.87534bce.js";import"./useSize.8ad3cf11.js";import"./eagerComputed.8adbbac4.js";import"./useContentViewHeight.37be086d.js";import"./ArrowLeftOutlined.84966bd7.js";import"./index.5a7725c6.js";import"./transButton.ade55051.js";import"./useFlexGapSupport.200dd37b.js";import"./throttleByAnimationFrame.d2983414.js";var Be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"},Ee=Be;function k(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},a=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable}))),a.forEach(function(s){Fe(e,s,n[s])})}return e}function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(t,n){var a=k({},t,n.attrs);return f(S,k({},a,{icon:Ee}),null)};T.displayName="MinusCircleOutlined";T.inheritAttrs=!1;var Ae=T,Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M316 672h60c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8zm196-50c22.1 0 40-17.9 40-39 0-23.1-17.9-41-40-41s-40 17.9-40 41c0 21.1 17.9 39 40 39zm0-140c22.1 0 40-17.9 40-39 0-23.1-17.9-41-40-41s-40 17.9-40 41c0 21.1 17.9 39 40 39z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}},{tag:"path",attrs:{d:"M648 672h60c4.4 0 8-3.6 8-8V360c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v304c0 4.4 3.6 8 8 8z"}}]},name:"one-to-one",theme:"outlined"},Se=Ie;function H(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},a=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable}))),a.forEach(function(s){Te(e,s,n[s])})}return e}function Te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z=function(t,n){var a=H({},t,n.attrs);return f(S,H({},a,{icon:Se}),null)};z.displayName="OneToOneOutlined";z.inheritAttrs=!1;var ze=z,$e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},xe=$e;function L(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?Object(arguments[t]):{},a=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(a=a.concat(Object.getOwnPropertySymbols(n).filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable}))),a.forEach(function(s){De(e,s,n[s])})}return e}function De(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=function(t,n){var a=L({},t,n.attrs);return f(S,L({},a,{icon:xe}),null)};$.displayName="PlusCircleOutlined";$.inheritAttrs=!1;var Ve=$,je=/^djs-cursor-.*$/;function G(e){var t=be(document.body);t.removeMatching(je),e&&t.add("djs-cursor-"+e)}function Re(){G(null)}var Ne=5e3;function ke(e,t){t=t||"element.click";function n(){return!1}return e.once(t,Ne,n),function(){e.off(t,n)}}function Z(e,t){return{x:e.x-t.x,y:e.y-t.y}}function X(e){return e.pointers&&e.pointers.length&&(e=e.pointers[0]),e.touches&&e.touches.length&&(e=e.touches[0]),e?{x:e.clientX,y:e.clientY}:null}var He=15;function q(e,t){var n;e.on("element.mousedown",500,function(i){return _(i.originalEvent)});function a(i){var u=n.start,c=n.button,p=X(i),v=Z(p,u);if(!n.dragging&&Le(v)>He&&(n.dragging=!0,c===0&&ke(e),G("grab")),n.dragging){var M=n.last||n.start;v=Z(p,M),t.scroll({dx:v.x,dy:v.y}),n.last=p}i.preventDefault()}function s(i){B.unbind(document,"mousemove",a),B.unbind(document,"mouseup",s),n=null,Re()}function _(i){if(!we(i.target,".djs-draggable")){var u=i.button;if(!(u>=2||i.ctrlKey||i.shiftKey||i.altKey))return n={button:u,start:X(i)},B.bind(document,"mousemove",a),B.bind(document,"mouseup",s),!0}}this.isActive=function(){return!!n}}q.$inject=["eventBus","canvas"];function Le(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}var Ze={__init__:["moveCanvas"],moveCanvas:["type",q]};let m=null;const{createMessage:Xe}=ge(),Ge=ie({props:{title:{type:String,default:"\u6D41\u7A0B\u9884\u89C8"}},name:"BpmnPreview",components:{BasicModal:ne,PageWrapper:re,Tag:ve,Spin:le,Popover:se,Button:R,RadioButtonGroup:R.RadioButtonGroup,FramePage:ye,Space:he,Affix:Oe,PlusCircleOutlined:Ve,MinusCircleOutlined:Ae,OneToOneOutlined:ze},setup(e,{emit:t}){const n=C(),a=C(),s=C(""),_=C(!1),i=C(1);let u=[],c=[],p={};const v=C({});let M="";const[E,{changeLoading:P,setModalProps:h}]=oe(l=>F(this,null,function*(){const{modelKey:r,procInstId:o}=l;M=o,P(!0);try{yield U(r,o)}finally{P(!1)}}));function U(l,r){return F(this,null,function*(){m&&m.destroy(),m=new Me({container:document.getElementById("bpmnCanvas"),width:"100%",additionalModules:[Ze]}),r?_e({procInstId:r}).then(o=>{h({title:"\u6D41\u7A0B\u56FE - "+(o.modelName||"")}),c=o.highLightedFlows,u=o.activeActivityIds,m?x(o.modelXml):console.error("bpmnViewer is null or undefined!")}).finally(()=>{}):Ce({modelKey:l}).then(o=>{o?(h({title:"\u6D41\u7A0B\u56FE - "+(o.modelName||"")}),m?x(o.modelXml):console.error("bpmnViewer is null or undefined!")):(h({title:"\u6D41\u7A0B\u56FE - \u672A\u5B9A\u4E49"}),Xe.warning("\u672A\u627E\u5230\u6D41\u7A0B\u6A21\u677F\u6570\u636E\uFF01"))}).finally(()=>{})})}function W(l,r,o){let d=[],y="<"+r+"[^<>]*?\\s"+o+`=['"]?(.*?)['"]?\\s.*?>`,V=l.match(new RegExp(y,"gi"));return V&&V.forEach(j=>{j&&d.push(j)}),d}function x(l){const r=W(l,"exclusiveGateway","id");let o=l;r&&r.length>0&&r.forEach(d=>{const y=new RegExp('id="(.+?)"').exec(d);y&&y[1]&&(o=o.replace('bpmnElement="'+y[1]+'"','bpmnElement="'+y[1]+'" isMarkerVisible="true"'))}),m.importXML(o,function(d){d?console.error(d):Y()})}function Y(){const l=m.get("canvas");l.zoom("fit-viewport","auto"),J(l),Q()}function J(l){u&&u.length>0&&u.forEach(r=>{l.addMarker(r,"highlight");const o=document.querySelector(".highlight").querySelector(".djs-visual rect");o&&o.setAttribute("stroke-dasharray","4,4")}),c&&c.length>0&&c.forEach(r=>{l.addMarker(r,"highlight-line")})}function D(l,r,o){const d=document.createElement("div");v.value=l;const y=document.querySelector(".flowMsgPopover");d.innerHTML=y.innerHTML,d.className="tipBox",d.style.width="260px",d.style.background="rgba(255, 255, 255, .6)",o.add(l.id,{position:{top:r.element.height,left:0},html:d})}function Q(){const l=m.get("eventBus"),r=m.get("overlays");l.on("element.hover",o=>{o.element.type==="bpmn:UserTask"&&M&&(p[o.element.id]?D(p[o.element.id],o,r):Pe({procInstId:M,elementId:o.element.id}).then(d=>{p[o.element.id]=d,D(d,o,r)}))}),l.on("element.out",o=>{o.element.type,r.clear()})}function K(l=.1){let r=Math.floor(i.value*100+l*100)/100;if(r>4)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be greater than 4");i.value=r,m.get("canvas").zoom(i.value)}function ee(l=.1){let r=Math.floor(i.value*100-l*100)/100;if(r<.2)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be less than 0.2");i.value=r,m.get("canvas").zoom(i.value)}function te(){i.value=1,m.get("canvas").zoom("fit-viewport","auto")}return{defaultZoom:i,registerModal:E,flowMsgPopover:a,popoverVisible:_,triggerEl:n,detailInfo:v,previewUrl:s,processZoomIn:K,processZoomOut:ee,processReZoom:te}}}),qe={style:{position:"absolute",left:"10px",top:"10px","z-index":"999"}},Ue={class:"containers",ref:"container"},We={class:"popover-title"};function Ye(e,t,n,a,s,_){const i=b("MinusCircleOutlined"),u=b("Button"),c=b("PlusCircleOutlined"),p=b("OneToOneOutlined"),v=b("RadioButtonGroup"),M=b("Tag"),E=b("Popover"),P=b("BasicModal");return A(),N(P,fe({wrapClassName:"bpmn-viewer-container"},e.$attrs,{onRegister:e.registerModal}),{default:O(()=>[g("div",qe,[f(v,{value:"center"},{default:O(()=>[f(u,{value:"small",title:"\u7F29\u5C0F\u89C6\u56FE",style:{width:"40px"},size:"small",onClick:t[0]||(t[0]=h=>e.processZoomOut())},{icon:O(()=>[f(i)]),_:1}),f(u,{value:"default",size:"small",style:{width:"50px"}},{default:O(()=>[I(w(Math.floor(e.defaultZoom*10*10)+"%"),1)]),_:1}),f(u,{value:"large",title:"\u653E\u5927\u89C6\u56FE",style:{width:"40px"},size:"small",onClick:t[1]||(t[1]=h=>e.processZoomIn())},{icon:O(()=>[f(c)]),_:1}),f(u,{value:"center",title:"\u91CD\u7F6E\u89C6\u56FE\u5E76\u5C45\u4E2D",style:{width:"40px"},size:"small",onClick:t[2]||(t[2]=h=>e.processReZoom())},{default:O(()=>[f(p)]),_:1})]),_:1})]),g("div",Ue,[g("div",{id:"bpmnCanvas",class:"canvas",ref:"bpmnCanvas",style:ue({width:100*e.scale+"%",height:100*e.scale+"%"})},null,4)],512),f(E,{overlayClassName:"flowMsgPopover",ref:"flowMsgPopover",visible:!0},{title:O(()=>[g("h1",We,w(e.detailInfo.name),1)]),content:O(()=>[g("p",null,[I(" \u5BA1\u6279\u4EBA\u5458\uFF1A"),e.detailInfo.approver?(A(!0),ce(de,{key:0},pe(e.detailInfo.approver.split(";"),h=>(A(),N(M,{color:"processing",style:{"margin-right":"4px","margin-bottom":"4px"},key:h},{default:O(()=>[I(w(h),1)]),_:2},1024))),128)):me("",!0)]),g("p",null,"\u8282\u70B9\u7C7B\u578B\uFF1A"+w(e.detailInfo.nodeType||""),1),g("p",null,"\u8282\u70B9\u72B6\u6001\uFF1A"+w(e.detailInfo.status||""),1),g("p",null,"\u5F00\u59CB\u65F6\u95F4\uFF1A"+w(e.detailInfo.startDate||""),1),g("p",null,"\u7ED3\u675F\u65F6\u95F4\uFF1A"+w(e.detailInfo.endDate||""),1),g("p",null,"\u5BA1\u6279\u8017\u65F6\uFF1A"+w(e.detailInfo.duration||""),1)]),_:1},512)]),_:1},16,["onRegister"])}var yt=ae(Ge,[["render",Ye],["__scopeId","data-v-f4ba1872"]]);export{yt as default};
