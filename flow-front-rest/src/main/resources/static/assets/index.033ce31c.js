var e=(e,t,n)=>new Promise(((o,a)=>{var s=e=>{try{r(n.next(e))}catch(t){a(t)}},i=e=>{try{r(n.throw(e))}catch(t){a(t)}},r=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,i);r((n=n.apply(e,t)).next())}));import{B as t,b as n}from"./index.4d1e0212.js";import{P as o}from"./index.f67f9ef2.js";import{y as a,b5 as s,aK as i,ak as r,aM as l,bX as d,bZ as u,c0 as c,c1 as m,c2 as p,r as f,z as v,A as g,Z as h,B as y,F as w,v as x,a8 as b,J as M,a6 as I,an as j,a7 as P,a0 as C,K as B}from"./vendor.3dc066e5.js";/* empty css              *//* empty css              *//* empty css              */import E from"./index.79d67e97.js";import{c as _,a as k,t as z,b as O,V as T}from"./Viewer.06f57865.js";import{e as Z,l as R,f as K}from"./process.978d1578.js";import"./index.06582e88.js";import"./useWindowSizeFn.308e6090.js";/* empty css              *//* empty css              */import"./onMountedOrActivated.c01d8630.js";import"./useContentViewHeight.efd2f5af.js";var S=/^djs-cursor-.*$/;function A(e){var t=_(document.body);t.removeMatching(S),e&&t.add("djs-cursor-"+e)}function D(e,t){return{x:e.x-t.x,y:e.y-t.y}}function L(e,t){var n;function o(o){var a,s=n.start,i=n.button,r=z(o),l=D(r,s);(!n.dragging&&(a=l,Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))>15)&&(n.dragging=!0,0===i&&function(e,t){function n(){return!1}t=t||"element.click",e.once(t,5e3,n)}(e),A("grab")),n.dragging)&&(l=D(r,n.last||n.start),t.scroll({dx:l.x,dy:l.y}),n.last=r);o.preventDefault()}function a(e){O.unbind(document,"mousemove",o),O.unbind(document,"mouseup",a),n=null,A(null)}e.on("element.mousedown",500,(function(e){return function(e){if(k(e.target,".djs-draggable"))return;var t=e.button;if(t>=2||e.ctrlKey||e.shiftKey||e.altKey)return;return n={button:t,start:z(e)},O.bind(document,"mousemove",o),O.bind(document,"mouseup",a),!0}(e.originalEvent)})),this.isActive=function(){return!!n}}L.$inject=["eventBus","canvas"];var N={__init__:["moveCanvas"],moveCanvas:["type",L]};let V=null;var q=a({props:{title:{type:String,default:"流程预览"}},name:"BpmnPreview",components:{BasicModal:t,PageWrapper:o,Tag:s,Spin:i,Popover:r,Button:l,RadioButtonGroup:l.RadioButtonGroup,FramePage:E,Space:d,Affix:u,PlusCircleOutlined:c,MinusCircleOutlined:m,OneToOneOutlined:p},setup(t,{emit:o}){const a=f(),s=f(),i=f(""),r=f(!1),l=f(1);let d=[],u=[],c={};const m=f({});let p="";const[v,{changeLoading:g,setModalProps:h}]=n((t=>e(this,null,(function*(){const{modelKey:n,procInstId:o}=t;p=o,g(!0);try{yield function(t,n){return e(this,null,(function*(){V&&V.destroy(),V=new T({container:document.getElementById("bpmnCanvas"),width:"100%",additionalModules:[N]}),n?Z({procInstId:n}).then((e=>{h({title:"流程图 - "+(e.modelName||"")}),u=e.highLightedFlows,d=e.activeActivityIds,V&&y(e.modelXml)})).finally((()=>{})):R({modelKey:t}).then((e=>{h({title:"流程图 - "+(e.modelName||"")}),V&&y(e.modelXml)})).finally((()=>{}))}))}(n,o)}finally{g(!1)}}))));function y(e){const t=function(e,t,n){let o=[],a="<"+t+"[^<>]*?\\s"+n+"=['\"]?(.*?)['\"]?\\s.*?>",s=e.match(new RegExp(a,"gi"));return s&&s.forEach((e=>{e&&o.push(e)})),o}(e,"exclusiveGateway","id");let n=e;t&&t.length>0&&t.forEach((e=>{const t=new RegExp('id="(.+?)"').exec(e);t&&t[1]&&(n=n.replace('bpmnElement="'+t[1]+'"','bpmnElement="'+t[1]+'" isMarkerVisible="true"'))})),V.importXML(n,(function(e){e||function(){const e=V.get("canvas");e.zoom("fit-viewport","auto"),function(e){d&&d.length>0&&d.forEach((t=>{e.addMarker(t,"highlight");const n=document.querySelector(".highlight").querySelector(".djs-visual rect");n&&n.setAttribute("stroke-dasharray","4,4")}));u&&u.length>0&&u.forEach((t=>{e.addMarker(t,"highlight-line")}))}(e),function(){const e=V.get("eventBus"),t=V.get("overlays");e.on("element.hover",(e=>{"bpmn:UserTask"===e.element.type&&p&&(c[e.element.id]?w(c[e.element.id],e,t):K({procInstId:p,elementId:e.element.id}).then((n=>{c[e.element.id]=n,w(n,e,t)})))})),e.on("element.out",(e=>{e.element.type,t.clear()}))}()}()}))}function w(e,t,n){const o=document.createElement("div");m.value=e;const a=document.querySelector(".flowMsgPopover");o.innerHTML=a.innerHTML,o.className="tipBox",o.style.width="260px",o.style.background="rgba(255, 255, 255, .6)",n.add(e.id,{position:{top:t.element.height,left:0},html:o})}return{defaultZoom:l,registerModal:v,flowMsgPopover:s,popoverVisible:r,triggerEl:a,detailInfo:m,previewUrl:i,processZoomIn:function(e=.1){let t=Math.floor(100*l.value+100*e)/100;if(t>4)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be greater than 4");l.value=t,V.get("canvas").zoom(l.value)},processZoomOut:function(e=.1){let t=Math.floor(100*l.value-100*e)/100;if(t<.2)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be less than 0.2");l.value=t,V.get("canvas").zoom(l.value)},processReZoom:function(){l.value=1,V.get("canvas").zoom("fit-viewport","auto")}}}});const F=B();v("data-v-32d0a98d");const G={style:{position:"absolute",left:"10px",top:"10px","z-index":"999"}},W={class:"containers",ref:"container"},X={class:"popover-title"},H=b(" 审批人员：");g();const $=F(((e,t,n,o,a,s)=>{const i=h("MinusCircleOutlined"),r=h("Button"),l=h("PlusCircleOutlined"),d=h("OneToOneOutlined"),u=h("RadioButtonGroup"),c=h("Tag"),m=h("Popover"),p=h("BasicModal");return y(),w(p,C({wrapClassName:"bpmn-viewer-container"},e.$attrs,{onRegister:e.registerModal}),{default:F((()=>[x("div",G,[x(u,{value:"center"},{default:F((()=>[x(r,{value:"small",title:"缩小视图",style:{width:"40px"},size:"small",onClick:t[1]||(t[1]=t=>e.processZoomOut())},{icon:F((()=>[x(i)])),_:1}),x(r,{value:"default",size:"small",style:{width:"50px"}},{default:F((()=>[b(M(Math.floor(10*e.defaultZoom*10)+"%"),1)])),_:1}),x(r,{value:"large",title:"放大视图",style:{width:"40px"},size:"small",onClick:t[2]||(t[2]=t=>e.processZoomIn())},{icon:F((()=>[x(l)])),_:1}),x(r,{value:"center",title:"重置视图并居中",style:{width:"40px"},size:"small",onClick:t[3]||(t[3]=t=>e.processReZoom())},{default:F((()=>[x(d)])),_:1})])),_:1})]),x("div",W,[x("div",{id:"bpmnCanvas",class:"canvas",ref:"bpmnCanvas",style:{width:100*e.scale+"%",height:100*e.scale+"%"}},null,4)],512),x(m,{overlayClassName:"flowMsgPopover",ref:"flowMsgPopover",visible:!0},{title:F((()=>[x("h1",X,M(e.detailInfo.name),1)])),content:F((()=>[x("p",null,[H,e.detailInfo.approver?(y(!0),w(I,{key:0},j(e.detailInfo.approver.split(";"),(e=>(y(),w(c,{color:"processing",style:{"margin-right":"4px","margin-bottom":"4px"},key:e},{default:F((()=>[b(M(e),1)])),_:2},1024)))),128)):P("",!0)]),x("p",null,"节点类型："+M(e.detailInfo.nodeType||""),1),x("p",null,"节点状态："+M(e.detailInfo.status||""),1),x("p",null,"开始时间："+M(e.detailInfo.startDate||""),1),x("p",null,"结束时间："+M(e.detailInfo.endDate||""),1),x("p",null,"审批耗时："+M(e.detailInfo.duration||""),1)])),_:1},512)])),_:1},16,["onRegister"])}));q.render=$,q.__scopeId="data-v-32d0a98d";export default q;
