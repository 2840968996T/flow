var e=(e,t,n)=>new Promise(((o,a)=>{var s=e=>{try{i(n.next(e))}catch(t){a(t)}},r=e=>{try{i(n.throw(e))}catch(t){a(t)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(s,r);i((n=n.apply(e,t)).next())}));import{_ as t,b as n}from"./useModal.7ee8a690.js";import{_ as o}from"./PageWrapper.01f0bc61.js";import{k as a,bg as s,aG as r,ad as i,aI as l,bS as c,bU as u,bX as d,bY as m,bZ as p,r as f,l as v,m as g,K as h,o as y,n as b,q as x,X as w,s as M,S as I,ag as j,W as P,N as _,x as C}from"./vendor.59fe1062.js";/* empty css              *//* empty css              *//* empty css              */import E from"./index.69af581d.js";import{c as k,a as O,t as z,b as B,V as T}from"./Viewer.f6103f50.js";import{e as R,l as S,f as Z}from"./process.b37f0197.js";import"./index.21cfc268.js";import"./useWindowSizeFn.cd99a382.js";import"./usePageContext.557e08ad.js";/* empty css              *//* empty css              */import"./onMountedOrActivated.932ae6a7.js";var K=/^djs-cursor-.*$/;function N(e){var t=k(document.body);t.removeMatching(K),e&&t.add("djs-cursor-"+e)}function W(e,t){return{x:e.x-t.x,y:e.y-t.y}}function q(e,t){var n;function o(o){var a,s=n.start,r=n.button,i=z(o),l=W(i,s);(!n.dragging&&(a=l,Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))>15)&&(n.dragging=!0,0===r&&function(e,t){function n(){return!1}t=t||"element.click",e.once(t,5e3,n)}(e),N("grab")),n.dragging)&&(l=W(i,n.last||n.start),t.scroll({dx:l.x,dy:l.y}),n.last=i);o.preventDefault()}function a(e){B.unbind(document,"mousemove",o),B.unbind(document,"mouseup",a),n=null,N(null)}e.on("element.mousedown",500,(function(e){return function(e){if(O(e.target,".djs-draggable"))return;var t=e.button;if(t>=2||e.ctrlKey||e.shiftKey||e.altKey)return;return n={button:t,start:z(e)},B.bind(document,"mousemove",o),B.bind(document,"mouseup",a),!0}(e.originalEvent)})),this.isActive=function(){return!!n}}q.$inject=["eventBus","canvas"];var A={__init__:["moveCanvas"],moveCanvas:["type",q]};let D=null;var G=a({props:{title:{type:String,default:"流程预览"}},name:"BpmnPreview",components:{BasicModal:t,PageWrapper:o,Tag:s,Spin:r,Popover:i,Button:l,RadioButtonGroup:l.RadioButtonGroup,FramePage:E,Space:c,Affix:u,PlusCircleOutlined:d,MinusCircleOutlined:m,OneToOneOutlined:p},setup(t,{emit:o}){const a=f(),s=f(),r=f(""),i=f(!1),l=f(1);let c=[],u=[],d={};const m=f({});let p="";const[v,{changeLoading:g,setModalProps:h}]=n((t=>e(this,null,(function*(){const{modelKey:n,procInstId:o}=t;p=o,g(!0);try{yield function(t,n){return e(this,null,(function*(){D&&D.destroy(),D=new T({container:document.getElementById("bpmnCanvas"),width:"100%",additionalModules:[A]}),n?R({procInstId:n}).then((e=>{h({title:"流程图 - "+(e.modelName||"")}),u=e.highLightedFlows,c=e.activeActivityIds,D&&y(e.modelXml)})).finally((()=>{})):S({modelKey:t}).then((e=>{h({title:"流程图 - "+(e.modelName||"")}),D&&y(e.modelXml)})).finally((()=>{}))}))}(n,o)}finally{g(!1)}}))));function y(e){const t=function(e,t,n){let o=[],a="<"+t+"[^<>]*?\\s"+n+"=['\"]?(.*?)['\"]?\\s.*?>",s=e.match(new RegExp(a,"gi"));return s&&s.forEach((e=>{e&&o.push(e)})),o}(e,"exclusiveGateway","id");let n=e;t&&t.length>0&&t.forEach((e=>{const t=new RegExp('id="(.+?)"').exec(e);t&&t[1]&&(n=n.replace('bpmnElement="'+t[1]+'"','bpmnElement="'+t[1]+'" isMarkerVisible="true"'))})),D.importXML(n,(function(e){e||function(){const e=D.get("canvas");e.zoom("fit-viewport","auto"),function(e){c&&c.length>0&&c.forEach((t=>{e.addMarker(t,"highlight");const n=document.querySelector(".highlight").querySelector(".djs-visual rect");n&&n.setAttribute("stroke-dasharray","4,4")}));u&&u.length>0&&u.forEach((t=>{e.addMarker(t,"highlight-line")}))}(e),function(){const e=D.get("eventBus"),t=D.get("overlays");e.on("element.hover",(e=>{"bpmn:UserTask"===e.element.type&&p&&(d[e.element.id]?b(d[e.element.id],e,t):Z({procInstId:p,elementId:e.element.id}).then((n=>{d[e.element.id]=n,b(n,e,t)})))})),e.on("element.out",(e=>{e.element.type,t.clear()}))}()}()}))}function b(e,t,n){const o=document.createElement("div");m.value=e;const a=document.querySelector(".flowMsgPopover");o.innerHTML=a.innerHTML,o.className="tipBox",o.style.width="260px",o.style.background="rgba(255, 255, 255, .6)",n.add(e.id,{position:{top:t.element.height,left:0},html:o})}return{defaultZoom:l,registerModal:v,flowMsgPopover:s,popoverVisible:i,triggerEl:a,detailInfo:m,previewUrl:r,processZoomIn:function(e=.1){let t=Math.floor(100*l.value+100*e)/100;if(t>4)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be greater than 4");l.value=t,D.get("canvas").zoom(l.value)},processZoomOut:function(e=.1){let t=Math.floor(100*l.value-100*e)/100;if(t<.2)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be less than 0.2");l.value=t,D.get("canvas").zoom(l.value)},processReZoom:function(){l.value=1,D.get("canvas").zoom("fit-viewport","auto")}}}});const L=C();v("data-v-370cf649");const X={style:{position:"absolute",left:"10px",top:"10px","z-index":"999"}},V={class:"containers",ref:"container"},F={class:"popover-title"},U=w(" 审批人员：");g();const $=L(((e,t,n,o,a,s)=>{const r=h("MinusCircleOutlined"),i=h("Button"),l=h("PlusCircleOutlined"),c=h("OneToOneOutlined"),u=h("RadioButtonGroup"),d=h("Tag"),m=h("Popover"),p=h("BasicModal");return y(),b(p,_({wrapClassName:"bpmn-viewer-container"},e.$attrs,{onRegister:e.registerModal}),{default:L((()=>[x("div",X,[x(u,{value:"center"},{default:L((()=>[x(i,{value:"small",title:"缩小视图",style:{width:"40px"},size:"small",onClick:t[1]||(t[1]=t=>e.processZoomOut())},{icon:L((()=>[x(r)])),_:1}),x(i,{value:"default",size:"small",style:{width:"50px"}},{default:L((()=>[w(M(Math.floor(10*e.defaultZoom*10)+"%"),1)])),_:1}),x(i,{value:"large",title:"放大视图",style:{width:"40px"},size:"small",onClick:t[2]||(t[2]=t=>e.processZoomIn())},{icon:L((()=>[x(l)])),_:1}),x(i,{value:"center",title:"重置视图并居中",style:{width:"40px"},size:"small",onClick:t[3]||(t[3]=t=>e.processReZoom())},{default:L((()=>[x(c)])),_:1})])),_:1})]),x("div",V,[x("div",{id:"bpmnCanvas",class:"canvas",ref:"bpmnCanvas",style:{width:100*e.scale+"%",height:100*e.scale+"%"}},null,4)],512),x(m,{overlayClassName:"flowMsgPopover",ref:"flowMsgPopover",visible:!0},{title:L((()=>[x("h1",F,M(e.detailInfo.name),1)])),content:L((()=>[x("p",null,[U,e.detailInfo.approver?(y(!0),b(I,{key:0},j(e.detailInfo.approver.split(";"),(e=>(y(),b(d,{color:"processing",style:{"margin-right":"4px","margin-bottom":"4px"},key:e},{default:L((()=>[w(M(e),1)])),_:2},1024)))),128)):P("",!0)]),x("p",null,"节点类型："+M(e.detailInfo.nodeType||""),1),x("p",null,"节点状态："+M(e.detailInfo.status||""),1),x("p",null,"开始时间："+M(e.detailInfo.startDate||""),1),x("p",null,"结束时间："+M(e.detailInfo.endDate||""),1),x("p",null,"审批耗时："+M(e.detailInfo.duration||""),1)])),_:1},512)])),_:1},16,["onRegister"])}));G.render=$,G.__scopeId="data-v-370cf649";export default G;
