import{_ as e,b as t}from"./useModal.fddc6186.js";import{_ as o}from"./PageWrapper.5ef0540d.js";import{k as n,bg as a,aG as s,ad as r,aI as i,bS as l,bU as c,bX as d,bY as u,bZ as m,r as p,f,l as v,m as g,K as h,o as y,n as b,q as x,X as w,s as M,S as I,ag as j,W as P,N as _,x as C}from"./vendor.d660e98f.js";/* empty css              *//* empty css              *//* empty css              */import E from"./index.ef1e9878.js";import{c as k,a as O,t as z,b as B,V as T}from"./Viewer.fd8523c8.js";import{e as R,l as S,f as Z}from"./process.f0749243.js";import"./index.dd44fc8e.js";import"./useWindowSizeFn.4f1b8c18.js";import"./usePageContext.913e3c16.js";/* empty css              *//* empty css              */import"./onMountedOrActivated.a3bdff8d.js";var K=/^djs-cursor-.*$/;function N(e){var t=k(document.body);t.removeMatching(K),e&&t.add("djs-cursor-"+e)}function W(e,t){return{x:e.x-t.x,y:e.y-t.y}}function q(e,t){var o;function n(n){var a,s=o.start,r=o.button,i=z(n),l=W(i,s);(!o.dragging&&(a=l,Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))>15)&&(o.dragging=!0,0===r&&function(e,t){function o(){return!1}t=t||"element.click",e.once(t,5e3,o)}(e),N("grab")),o.dragging)&&(l=W(i,o.last||o.start),t.scroll({dx:l.x,dy:l.y}),o.last=i);n.preventDefault()}function a(e){B.unbind(document,"mousemove",n),B.unbind(document,"mouseup",a),o=null,N(null)}e.on("element.mousedown",500,(function(e){return function(e){if(O(e.target,".djs-draggable"))return;var t=e.button;if(t>=2||e.ctrlKey||e.shiftKey||e.altKey)return;return o={button:t,start:z(e)},B.bind(document,"mousemove",n),B.bind(document,"mouseup",a),!0}(e.originalEvent)})),this.isActive=function(){return!!o}}q.$inject=["eventBus","canvas"];var A={__init__:["moveCanvas"],moveCanvas:["type",q]};let D=null;var G=n({props:{title:{type:String,default:"流程预览"}},name:"BpmnPreview",components:{BasicModal:e,PageWrapper:o,Tag:a,Spin:s,Popover:r,Button:i,RadioButtonGroup:i.RadioButtonGroup,FramePage:E,Space:l,Affix:c,PlusCircleOutlined:d,MinusCircleOutlined:u,OneToOneOutlined:m},setup(e,{emit:o}){p(),p();const n=p(),a=p(),s=p(""),r=p(!1),i=p(""),l=p(1);let c=[],d=[],u={};const m=p({});let v="";const[g,{setModalProps:h,closeModal:y,changeLoading:b}]=t((e=>{return t=this,o=null,n=function*(){const{modelKey:t,procInstId:o}=e;v=o,b(!0),function(e,t){D&&D.destroy(),D=new T({container:document.getElementById("bpmnCanvas"),width:"100%",additionalModules:[A]}),t?R({procInstId:t}).then((e=>{i.value=e.modelName||"",d=e.highLightedFlows,c=e.activeActivityIds,D&&w(e.modelXml),b(!1)})):S({modelKey:e}).then((e=>{i.value=e.mldelName||"",D&&w(e.modelXml),b(!1)}))}(t,o)},new Promise(((e,a)=>{var s=e=>{try{i(n.next(e))}catch(t){a(t)}},r=e=>{try{i(n.throw(e))}catch(t){a(t)}},i=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,r);i((n=n.apply(t,o)).next())}));var t,o,n})),x=f((()=>"流程图-"+i.value));function w(e){const t=function(e,t,o){let n=[],a="<"+t+"[^<>]*?\\s"+o+"=['\"]?(.*?)['\"]?\\s.*?>",s=e.match(new RegExp(a,"gi"));return s&&s.forEach((e=>{e&&n.push(e)})),n}(e,"exclusiveGateway","id");let o=e;t&&t.length>0&&t.forEach((e=>{const t=new RegExp('id="(.+?)"').exec(e);t&&t[1]&&(o=o.replace('bpmnElement="'+t[1]+'"','bpmnElement="'+t[1]+'" isMarkerVisible="true"'))})),D.importXML(o,(function(e){e||function(){const e=D.get("canvas");e.zoom("fit-viewport","auto"),function(e){c&&c.length>0&&c.forEach((t=>{e.addMarker(t,"highlight");const o=document.querySelector(".highlight").querySelector(".djs-visual rect");o&&o.setAttribute("stroke-dasharray","4,4")}));d&&d.length>0&&d.forEach((t=>{e.addMarker(t,"highlight-line")}))}(e),function(){const e=D.get("eventBus"),t=D.get("overlays");e.on("element.hover",(e=>{"bpmn:UserTask"===e.element.type&&v&&(u[e.element.id]?M(u[e.element.id],e,t):Z({procInstId:v,elementId:e.element.id}).then((o=>{u[e.element.id]=o,M(o,e,t)})))})),e.on("element.out",(e=>{e.element.type,t.clear()}))}()}()}))}function M(e,t,o){const n=document.createElement("div");m.value=e;const a=document.querySelector(".flowMsgPopover");n.innerHTML=a.innerHTML,n.className="tipBox",n.style.width="260px",n.style.background="rgba(255, 255, 255, .6)",o.add(e.id,{position:{top:t.element.height,left:0},html:n})}return{defaultZoom:l,registerModal:g,flowMsgPopover:a,popoverVisible:r,triggerEl:n,getTitle:x,detailInfo:m,previewUrl:s,processZoomIn:function(e=.1){let t=Math.floor(100*l.value+100*e)/100;if(t>4)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be greater than 4");l.value=t,D.get("canvas").zoom(l.value)},processZoomOut:function(e=.1){let t=Math.floor(100*l.value-100*e)/100;if(t<.2)throw new Error("[Process Designer Warn ]: The zoom ratio cannot be less than 0.2");l.value=t,D.get("canvas").zoom(l.value)},processReZoom:function(){l.value=1,D.get("canvas").zoom("fit-viewport","auto")}}}});const L=C();v("data-v-343c22de");const X={style:{position:"absolute",left:"10px",top:"10px","z-index":"999"}},V={class:"containers",ref:"container"},F={class:"popover-title"},U=w(" 审批人员：");g();const $=L(((e,t,o,n,a,s)=>{const r=h("MinusCircleOutlined"),i=h("Button"),l=h("PlusCircleOutlined"),c=h("OneToOneOutlined"),d=h("RadioButtonGroup"),u=h("Tag"),m=h("Popover"),p=h("BasicModal");return y(),b(p,_({wrapClassName:"bpmn-viewer-container"},e.$attrs,{onRegister:e.registerModal,title:e.getTitle}),{default:L((()=>[x("div",X,[x(d,{value:"center"},{default:L((()=>[x(i,{value:"small",title:"缩小视图",style:{width:"40px"},size:"small",onClick:t[1]||(t[1]=t=>e.processZoomOut())},{icon:L((()=>[x(r)])),_:1}),x(i,{value:"default",size:"small",style:{width:"50px"}},{default:L((()=>[w(M(Math.floor(10*e.defaultZoom*10)+"%"),1)])),_:1}),x(i,{value:"large",title:"放大视图",style:{width:"40px"},size:"small",onClick:t[2]||(t[2]=t=>e.processZoomIn())},{icon:L((()=>[x(l)])),_:1}),x(i,{value:"center",title:"重置视图并居中",style:{width:"40px"},size:"small",onClick:t[3]||(t[3]=t=>e.processReZoom())},{default:L((()=>[x(c)])),_:1})])),_:1})]),x("div",V,[x("div",{id:"bpmnCanvas",class:"canvas",ref:"bpmnCanvas",style:{width:100*e.scale+"%",height:100*e.scale+"%"}},null,4)],512),x(m,{overlayClassName:"flowMsgPopover",ref:"flowMsgPopover",visible:!0},{title:L((()=>[x("h1",F,M(e.detailInfo.name),1)])),content:L((()=>[x("p",null,[U,e.detailInfo.approver?(y(!0),b(I,{key:0},j(e.detailInfo.approver.split(";"),(e=>(y(),b(u,{color:"processing",style:{"margin-right":"4px","margin-bottom":"4px"},key:e},{default:L((()=>[w(M(e),1)])),_:2},1024)))),128)):P("",!0)]),x("p",null,"节点类型："+M(e.detailInfo.nodeType||""),1),x("p",null,"节点状态："+M(e.detailInfo.status||""),1),x("p",null,"开始时间："+M(e.detailInfo.startDate||""),1),x("p",null,"结束时间："+M(e.detailInfo.endDate||""),1),x("p",null,"审批耗时："+M(e.detailInfo.duration||""),1)])),_:1},512)])),_:1},16,["onRegister","title"])}));G.render=$,G.__scopeId="data-v-343c22de";export default G;
