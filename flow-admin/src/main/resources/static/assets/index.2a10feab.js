import{az as O,a as $,I as k,w as _,aB as a,o as A,k as I,B as l,p as t,C,l as U,n as M,j as B,G as V}from"./index.bbfb8c5d.js";import{T as W}from"./index.bd278e5f.js";import{S as K}from"./index.dbc537d6.js";import{A as L}from"./index.9b011968.js";import{B as H,S as j}from"./TableImg.3ff4c1b4.js";import{l as G}from"./BasicForm.bc1bc2ec.js";import{u as J}from"./useTable.dffabf3f.js";import{g as q,a as x,d as Q,b as X}from"./role.00e852ab.js";import{P as Y}from"./index.6f4a9d56.js";import Z from"./CompanyTree.94589b2b.js";import{b as z}from"./index.56ac9033.js";import{R as ee,s as N,c as oe,p as ne}from"./RoleModal.f860ea7e.js";import te from"./index.18428089.js";import{b as ae}from"./personal.4873b21f.js";import"./useFlexGapSupport.ae09cf13.js";import"./throttleByAnimationFrame.43f6b2a7.js";import"./index.08f5b20b.js";import"./Checkbox.6b0f0619.js";import"./index.932444ce.js";import"./index.424465cb.js";import"./eagerComputed.2918d49d.js";import"./useForm.35a2e1b5.js";import"./index.e860cc21.js";import"./index.ba9876ed.js";import"./uuid.2b29000c.js";import"./index.d0de3318.js";import"./_baseIteratee.6836a2b9.js";import"./get.476f8b78.js";import"./DeleteOutlined.426a7a56.js";import"./index.21d11494.js";import"./useRefs.c946e576.js";import"./Form.64d057a8.js";import"./Col.bf638c61.js";import"./useSize.2da926c0.js";import"./useWindowSizeFn.daa22200.js";import"./index.eb776706.js";import"./sortable.esm.c081a59d.js";import"./RedoOutlined.566a8b2c.js";import"./FullscreenOutlined.7b1f5985.js";import"./index.59bf1cba.js";import"./fromPairs.daf93cb7.js";import"./scrollTo.1bc5bfb7.js";import"./index.a824713f.js";/* empty css              *//* empty css               */import"./index.53f3ac38.js";import"./transButton.15723253.js";import"./index.1311bc71.js";import"./download.4c3fda74.js";import"./base64Conver.08b9f4ec.js";import"./index.5d0a6eed.js";import"./index.5796c3bd.js";import"./uniqBy.16bfb902.js";import"./index.b7fa4bcc.js";import"./index.8643b1cc.js";import"./useContentViewHeight.ce579b14.js";import"./ArrowLeftOutlined.32f822b8.js";import"./index.40637d17.js";import"./index.6f678a8f.js";import"./useContextMenu.b34fb2fb.js";import"./company.f7866801.js";import"./constantEnum.bf6653fb.js";import"./OrgTree.ff667f86.js";import"./dept.7ae8ecb4.js";const{createMessage:le}=V(),re=$({name:"RoleManagement",components:{BasicTable:H,PageWrapper:Y,CompanyTree:Z,RoleModal:ee,PersonalSelector:te,TableAction:G,Input:k,Tag:W,Affix:L,Space:K,Search:k.Search,SettingOutlined:j},setup(){const[n,{openModal:b}]=z(),[F,{openModal:v,setModalProps:D}]=z(),i=_({}),d=_([]),u=_({}),f=_({});N.forEach(e=>{e&&(e.componentProps.onkeypress=o=>{o.keyCode===13&&p()})});const[h,{reload:p}]=J({title:"\u5217\u8868",api:q,columns:oe,formConfig:{labelWidth:120,schemas:N,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},expandRowByClick:!0,useSearchForm:!0,showIndexColumn:!1,showTableSetting:!1,bordered:!1,pagination:!0,onExpand:(e,o)=>{e?(i.value=o,u.value[o.id]="",c(o.id,u.value[o.id])):d.value=[]},rowKey:"id",canResize:!1});function g(){b(!0,{isUpdate:!1})}function y(e,o){o.stopPropagation(),b(!0,{record:e,isUpdate:!0})}function c(e,o){x({roleId:e,personal:{keyword:o||""}}).then(r=>{f.value[e]=r})}function S(e,o){o.stopPropagation(),i.value=e,x({roleId:e.id}).then(r=>{v(!0,{selectorProps:{multiSelect:!0,selectedList:r.map(E=>({code:E.code,name:E.name}))}}),D({title:`\u8BBE\u7F6E\u89D2\u8272\u3010${e.name}\u3011\u4E0B\u7684\u4EBA\u5458`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}).finally(()=>{})}function w(e){if(e.children&&e.children.length>0){le.warning("\u6709\u5B50\u8282\u70B9\uFF0C\u4E0D\u80FD\u5220\u9664\uFF01");return}Q([e.id]).then(o=>{p()})}function R(e){ae({roleId:e.roleId,personalId:e.personalId}).then(()=>{c(e.roleId,"")})}function T(){setTimeout(()=>{p()},200)}function s(e,o){c(e,o)}function m(e){JSON.stringify(e);const o=e.map(r=>({id:r.id,code:r.code}));X({roleId:B(i).id,personalList:o}).then(()=>{d.value=[B(i).id],c(B(i).id,u.value[B(i).id])})}function P(e){p({searchInfo:{companyId:e?e.id:""}})}return{personalColumns:ne,currentRole:i,rolePersonalData:f,onSearchPerson:s,searchPersonTxt:u,registerTable:h,registerModal:n,registerPersonalModal:F,handleCreate:g,handleEdit:y,handleAddPersonal:S,handleDelete:w,handleDeletePersonal:R,handleSuccess:T,handleSettingPersonalSuccess:m,handleSelect:P}}}),se={class:"manager-range",style:{"text-align":"right"}};function ie(n,b,F,v,D,i){const d=a("CompanyTree"),u=a("Affix"),f=a("a-button"),h=a("TableAction"),p=a("Search"),g=a("Tag"),y=a("Space"),c=a("SettingOutlined"),S=a("BasicTable"),w=a("RoleModal"),R=a("PersonalSelector"),T=a("PageWrapper");return A(),I(T,{dense:"",contentFullHeight:"",contentClass:"flex"},{default:l(()=>[t(u,{"offset-top":"8",class:"w-1/4 xl:w-1/5"},{default:l(()=>[t(d,{contentFullHeight:"",onSelect:n.handleSelect},null,8,["onSelect"])]),_:1}),t(S,{onRegister:n.registerTable,class:"personal w-3/4 xl:w-4/5"},{toolbar:l(()=>[t(f,{type:"primary",onClick:n.handleCreate},{default:l(()=>[C("\u65B0\u589E")]),_:1},8,["onClick"])]),bodyCell:l(({column:s,record:m})=>[s.key==="action"?(A(),I(h,{key:0,actions:[{tooltip:"\u6DFB\u52A0\u4EBA\u5458",icon:"ant-design:user-add",onClick:n.handleAddPersonal.bind(null,m)},{tooltip:"\u4FEE\u6539",icon:"clarity:note-edit-line",onClick:n.handleEdit.bind(null,m)},{tooltip:"\u5220\u9664",icon:"ant-design:delete-outlined",color:"error",onClick:P=>{P.stopPropagation()},popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664",confirm:n.handleDelete.bind(null,m),placement:"left"}}]},null,8,["actions"])):U("",!0)]),expandedRowRender:l(({record:s,index:m,indent:P,expanded:e})=>[t(S,{title:"",size:"small",columns:n.personalColumns,useSearchForm:!1,immediate:!1,showIndexColumn:!0,showTableSetting:!1,bordered:!0,pagination:!1,actionColumn:`{
              align: 'center'
            }`,rowKey:"id",canResize:!1,searchInfo:{roleId:s.id},dataSource:n.rolePersonalData[s.id],class:"w-4/4 xl:w-5/5"},{customName:l(({rec:o})=>[M("span",null,[C(" \u59D3\u540D "),t(p,{value:n.searchPersonTxt[s.id],"onUpdate:value":r=>n.searchPersonTxt[s.id]=r,placeholder:"\u59D3\u540D/\u5DE5\u53F7/\u624B\u673A",style:{width:"150px"},size:"small",allowClear:"",onSearch:r=>{n.onSearchPerson(s.id,r)}},null,8,["value","onUpdate:value","onSearch"])])]),action:l(({record:o})=>[t(h,{actions:[{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664",confirm:n.handleDeletePersonal.bind(null,o),placement:"left"}}]},null,8,["actions"])]),setManagerRange:l(({record:o})=>[M("div",se,[t(y,{size:"small"},{default:l(()=>[t(g,{color:"processing"},{default:l(()=>[C("\u4E2D\u56FD\u77F3\u5316")]),_:1}),t(g,{color:"processing"},{default:l(()=>[C("\u4E2D\u56FD\u77F3\u5316")]),_:1})]),_:1}),t(c,{class:"ant-btn-link"})])]),_:2},1032,["columns","searchInfo","dataSource"])]),_:1},8,["onRegister"]),t(w,{onRegister:n.registerModal,onSuccess:n.handleSuccess},null,8,["onRegister","onSuccess"]),t(R,{onRegister:n.registerPersonalModal,onSuccess:n.handleSettingPersonalSuccess},null,8,["onRegister","onSuccess"])]),_:1})}var Co=O(re,[["render",ie]]);export{Co as default};
