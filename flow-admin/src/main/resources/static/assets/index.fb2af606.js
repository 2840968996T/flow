var ae=Object.defineProperty;var Q=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var X=(e,o,n)=>o in e?ae(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,V=(e,o)=>{for(var n in o||(o={}))ie.call(o,n)&&X(e,n,o[n]);if(Q)for(var n of Q(o))le.call(o,n)&&X(e,n,o[n]);return e};var W=(e,o,n)=>new Promise((l,u)=>{var P=d=>{try{h(n.next(d))}catch(m){u(m)}},S=d=>{try{h(n.throw(d))}catch(m){u(m)}},h=d=>d.done?l(d.value):Promise.resolve(d.value).then(P,S);h((n=n.apply(e,o)).next())});import{B as re}from"./TableImg.8efb1d09.js";import{l as se}from"./BasicForm.57c6e84a.js";import{u as ue}from"./useTable.975d5dab.js";import{g as ce,a as pe,s as de,d as me,b as fe}from"./personal.f988f263.js";import{P as ge}from"./index.fe38133b.js";import he from"./OrgTree.be9dcc6b.js";import{b as j}from"./index.1f9d3a9d.js";import{P as ve,c as be,s as Se}from"./PersonalModal.74167257.js";import ye from"./index.51d18c21.js";import Oe from"./index.cbc14bd5.js";import{p as s,s as te,az as Ce,a as _e,b4 as we,fC as Be,w,j as p,aB as a,o as g,k as B,B as f,C as z,l as N,i as x,F as Y,t as Z,aE as Pe}from"./index.97f55544.js";import{T as Me}from"./index.8e778cab.js";import{A as Re}from"./index.a43619a6.js";import{B as Ie}from"./index.264e2111.js";import{S as De}from"./index.a512493f.js";import{I as Ee}from"./index.39a555ee.js";import{U as Te}from"./UserOutlined.fd2f152b.js";import{D as Ae}from"./DeleteOutlined.3429193d.js";import"./index.cbf389d6.js";import"./Checkbox.7df03d8d.js";import"./index.23620c7a.js";import"./index.2043c4f4.js";import"./eagerComputed.009c9352.js";import"./useForm.1f0c5dd1.js";import"./index.5e0e80fc.js";import"./index.694ce07d.js";import"./uuid.2b29000c.js";import"./index.4675f512.js";import"./_baseIteratee.c5a78c1a.js";import"./get.d05ccbd6.js";import"./index.be63e913.js";import"./useRefs.a0940dd4.js";import"./Form.cdd7ca4e.js";import"./Col.39b2cbe8.js";import"./useFlexGapSupport.a588479c.js";import"./useSize.eb64bd2e.js";import"./useWindowSizeFn.61edac1b.js";import"./index.4592027a.js";import"./sortable.esm.2632adaa.js";import"./RedoOutlined.1fcb5099.js";import"./FullscreenOutlined.b5079cb0.js";import"./fromPairs.84aabb58.js";import"./scrollTo.b6445e84.js";/* empty css              *//* empty css               */import"./index.12848547.js";import"./transButton.76d507e2.js";import"./index.c0d032c8.js";import"./download.6452e165.js";import"./base64Conver.08b9f4ec.js";import"./index.5fe02a4f.js";import"./index.7c43370c.js";import"./uniqBy.45d4281c.js";import"./index.b145dae6.js";import"./useContentViewHeight.f7978643.js";import"./ArrowLeftOutlined.cdba934c.js";import"./index.73fcc7b5.js";import"./index.8cd44c0f.js";import"./useContextMenu.a6e3d036.js";import"./dept.77a8a079.js";import"./jobGrade.9fedcc51.js";import"./positionInfo.9dcebf85.js";import"./company.dfd397fe.js";import"./constantEnum.bf6653fb.js";import"./PlusOutlined.6cde877a.js";import"./role.816ac510.js";import"./CompanyTree.61c76188.js";var ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M874 120H622c-3.3 0-6 2.7-6 6v56c0 3.3 2.7 6 6 6h160.4L583.1 387.3c-50-38.5-111-59.3-175.1-59.3-76.9 0-149.3 30-203.6 84.4S120 539.1 120 616s30 149.3 84.4 203.6C258.7 874 331.1 904 408 904s149.3-30 203.6-84.4C666 765.3 696 692.9 696 616c0-64.1-20.8-124.9-59.2-174.9L836 241.9V402c0 3.3 2.7 6 6 6h56c3.3 0 6-2.7 6-6V150c0-16.5-13.5-30-30-30zM408 828c-116.9 0-212-95.1-212-212s95.1-212 212-212 212 95.1 212 212-95.1 212-212 212z"}}]},name:"man",theme:"outlined"},Fe=ke;function K(e){for(var o=1;o<arguments.length;o++){var n=arguments[o]!=null?Object(arguments[o]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),l.forEach(function(u){$e(e,u,n[u])})}return e}function $e(e,o,n){return o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}var H=function(o,n){var l=K({},o,n.attrs);return s(te,K({},l,{icon:Fe}),null)};H.displayName="ManOutlined";H.inheritAttrs=!1;var Le=H,Ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M712.8 548.8c53.6-53.6 83.2-125 83.2-200.8 0-75.9-29.5-147.2-83.2-200.8C659.2 93.6 587.8 64 512 64s-147.2 29.5-200.8 83.2C257.6 200.9 228 272.1 228 348c0 63.8 20.9 124.4 59.4 173.9 7.3 9.4 15.2 18.3 23.7 26.9 8.5 8.5 17.5 16.4 26.8 23.7 39.6 30.8 86.3 50.4 136.1 57V736H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h114v140c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V812h114c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8H550V629.5c61.5-8.2 118.2-36.1 162.8-80.7zM512 556c-55.6 0-107.7-21.6-147.1-60.9C325.6 455.8 304 403.6 304 348s21.6-107.7 60.9-147.1C404.2 161.5 456.4 140 512 140s107.7 21.6 147.1 60.9C698.4 240.2 720 292.4 720 348s-21.6 107.7-60.9 147.1C619.7 534.4 567.6 556 512 556z"}}]},name:"woman",theme:"outlined"},We=Ve;function ee(e){for(var o=1;o<arguments.length;o++){var n=arguments[o]!=null?Object(arguments[o]):{},l=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(l=l.concat(Object.getOwnPropertySymbols(n).filter(function(u){return Object.getOwnPropertyDescriptor(n,u).enumerable}))),l.forEach(function(u){je(e,u,n[u])})}return e}function je(e,o,n){return o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}var U=function(o,n){var l=ee({},o,n.attrs);return s(te,ee({},l,{icon:We}),null)};U.displayName="WomanOutlined";U.inheritAttrs=!1;var ze=U;const Ne=_e({name:"PersonalManagement",components:{BasicTable:re,Spin:we,Space:De,PageWrapper:ge,OrgTree:he,PersonalModal:ve,RoleSelector:ye,PersonalSelector:Oe,TableAction:se,Avatar:Re,Badge:Ie,Popconfirm:Be,Tag:Me,Image:Ee,DeleteOutlined:Ae,ManOutlined:Le,WomanOutlined:ze,UserOutlined:Te},setup(){const[e,{openModal:o,setModalProps:n}]=j(),[l,{openModal:u,setModalProps:P}]=j(),[S,{openModal:h,setModalProps:d}]=j(),m=w({}),y=w({}),M=w(""),O=w(!1),i=w({}),[I,{reload:b,setLoading:q}]=ue({title:"\u5217\u8868",api:ce,columns:be,formConfig:{labelWidth:120,schemas:Se,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},searchInfo:{showRoles:!0},size:"small",useSearchForm:!0,showIndexColumn:!1,bordered:!0,actionColumn:{width:120,title:"\u64CD\u4F5C",dataIndex:"action"},beforeFetch:t=>{var v,J;let r={};return((v=i.value)==null?void 0:v.sourceType)==="1"?r={companyId:p(i).id}:((J=i.value)==null?void 0:J.sourceType)==="2"&&(r={deptId:p(i).id}),V(V({},t),r)}});function D(){let t={};p(i)&&(p(i).sourceType==="1"?t={companyId:p(i).id}:p(i).sourceType==="2"&&(t={companyId:p(i).companyId,deptId:p(i).id})),o(!0,{isUpdate:!1,record:t}),n({title:"\u65B0\u589E\u4EBA\u5458",bodyStyle:{padding:"0px",margin:"0px"},width:800,height:400})}function E(t){o(!0,{record:t,isUpdate:!0}),n({title:"\u4FEE\u6539\u4EBA\u5458",bodyStyle:{padding:"0px",margin:"0px"},width:800,height:420})}function T(t){m.value=t,u(!0,{personalId:m.value.id}),P({title:`\u7ED9\u3010${t.name}(${t.code})\u3011\u6DFB\u52A0\u89D2\u8272`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}function A(t){m.value=t;let r=[];t.leaderCode&&t.leaderName&&r.push({id:t.id,code:t.leaderCode,name:t.leaderName}),h(!0,{selectorProps:{multiSelect:!1,selectedList:r}}),d({title:`\u7ED9\u3010${t.name}(${t.code})\u3011\u8BBE\u7F6E\u9886\u5BFC`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}function k(t){return W(this,null,function*(){const r=t.map(v=>({id:v.id}));yield pe({personalId:p(m).id,roles:r}),R()})}function F(t){return W(this,null,function*(){t&&t.length>0&&de({leaderCode:t[0].code,id:p(m).id}).then(()=>{R()}).finally(()=>{})})}function $(t){me([t.id]).then(r=>{b()})}function L(){b()}function C(){setTimeout(()=>{b()},200)}function c(){}function _(t){t&&(M.value=t,O.value=!0)}function G(t,r){O.value=t}function ne(t,r){y.value[t]=!0,fe({personalId:t,roleId:r}).then(()=>{R()}).finally(()=>{y.value[t]=!1})}function R(){var r,v;let t={};((r=i.value)==null?void 0:r.sourceType)==="1"?t={companyId:p(i).id}:((v=i.value)==null?void 0:v.sourceType)==="2"&&(t={deptId:p(i).id}),b({searchInfo:t})}function oe(t){i.value=t,R()}return{registerTable:I,registerRoleModal:l,registerPersonalModal:S,registerModal:e,deleteRoleLoading:y,previewImage:M,previewImageVisible:O,previewImageHandle:_,previewImageVisibleChange:G,handleCreate:D,handleEdit:E,confirmDeleteRole:ne,cancelDeleteRole:c,handleSettingRoles:T,handleSettingLeader:A,handleDelete:$,handleSuccess:C,handleSettingRoleSuccess:k,handleSettingLeaderSuccess:F,handleSelect:oe,doSearch:L}}}),xe={key:2,class:"personal-roles"};function He(e,o,n,l,u,P){const S=a("OrgTree"),h=a("a-button"),d=a("TableAction"),m=a("WomanOutlined"),y=a("ManOutlined"),M=a("UserOutlined"),O=a("Avatar"),i=a("Badge"),I=a("DeleteOutlined"),b=a("Popconfirm"),q=a("Tag"),D=a("Space"),E=a("Spin"),T=a("BasicTable"),A=a("Image"),k=a("PersonalModal"),F=a("RoleSelector"),$=a("PersonalSelector"),L=a("PageWrapper");return g(),B(L,{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex"},{default:f(()=>[s(S,{class:"w-1/4 xl:w-1/5",onSelect:e.handleSelect},null,8,["onSelect"]),s(T,{onRegister:e.registerTable,class:"w-3/4 xl:w-4/5"},{toolbar:f(()=>[s(h,{type:"primary",onClick:e.handleCreate},{default:f(()=>[z("\u65B0\u589E")]),_:1},8,["onClick"])]),bodyCell:f(({column:C,record:c})=>[C.key==="action"?(g(),B(d,{key:0,actions:[{tooltip:"\u4FEE\u6539",icon:"clarity:note-edit-line",onClick:e.handleEdit.bind(null,c)},{tooltip:"\u5220\u9664",icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664",confirm:e.handleDelete.bind(null,c),placement:"left"}}],dropDownActions:[{label:"\u5206\u914D\u89D2\u8272",title:"\u5206\u914D\u89D2\u8272",icon:"ant-design:usergroup-add",onClick:e.handleSettingRoles.bind(null,c)},{title:"\u8BBE\u7F6E\u9886\u5BFC",label:"\u8BBE\u7F6E\u9886\u5BFC",icon:"ant-design:setting-outlined",onClick:e.handleSettingLeader.bind(null,c)}]},null,8,["actions","dropDownActions"])):N("",!0),C.key==="name"?(g(),x(Y,{key:1},[s(i,null,{count:f(()=>[c.sex===2?(g(),B(m,{key:0,style:{color:"#f5222d","font-size":"12px"}})):(g(),B(y,{key:1,style:{color:"#1890ff","font-size":"12px"}}))]),default:f(()=>[s(O,{src:c.headImg,onClick:_=>e.previewImageHandle(c.headImg)},{icon:f(()=>[s(M)]),_:2},1032,["src","onClick"])]),_:2},1024),z(" "+Z(c.name),1)],64)):N("",!0),C.key==="roles"?(g(),x("div",xe,[s(E,{spinning:e.deleteRoleLoading&&e.deleteRoleLoading[c.id]?e.deleteRoleLoading[c.id]:!1},{default:f(()=>[s(D,null,{default:f(()=>[(g(!0),x(Y,null,Pe(c.roles,_=>(g(),B(q,{class:"role-item"},{default:f(()=>[z(Z(_.name)+" ",1),s(b,{title:"\u786E\u5B9A\u8981\u5220\u9664\u5417?","ok-text":"\u786E\u5B9A","cancel-text":"\u53D6\u6D88",onConfirm:G=>e.confirmDeleteRole(c.id,_.id),onCancel:e.cancelDeleteRole},{default:f(()=>[s(I,{color:"error",style:{color:"#d9595b"}})]),_:2},1032,["onConfirm","onCancel"])]),_:2},1024))),256))]),_:2},1024)]),_:2},1032,["spinning"])])):N("",!0)]),_:1},8,["onRegister"]),s(A,{width:0,height:0,src:e.previewImage,preview:{visible:e.previewImageVisible,onVisibleChange:e.previewImageVisibleChange}},null,8,["src","preview"]),s(k,{onRegister:e.registerModal,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),s(F,{onRegister:e.registerRoleModal,onSuccess:e.handleSettingRoleSuccess},null,8,["onRegister","onSuccess"]),s($,{onRegister:e.registerPersonalModal,onSuccess:e.handleSettingLeaderSuccess},null,8,["onRegister","onSuccess"])]),_:1})}var ln=Ce(Ne,[["render",He]]);export{ln as default};
