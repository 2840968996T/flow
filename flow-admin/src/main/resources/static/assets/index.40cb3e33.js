var e=Object.defineProperty,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,i=(o,n,t)=>n in o?e(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t,a=(e,a)=>{for(var l in a||(a={}))n.call(a,l)&&i(e,l,a[l]);if(o)for(var l of o(a))t.call(a,l)&&i(e,l,a[l]);return e},l=(e,o,n)=>new Promise(((t,i)=>{var a=e=>{try{r(n.next(e))}catch(o){i(o)}},l=e=>{try{r(n.throw(e))}catch(o){i(o)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(a,l);r((n=n.apply(e,o)).next())}));import{_ as r}from"./TableImg.b6d344fe.js";import{f as s}from"./BasicForm.8c0fc6b8.js";import{u as d}from"./useTable.01abb634.js";import{g as c,a as p,s as u,d as m,b as f}from"./personal.024d6b28.js";import{P as g}from"./index.30fbc9dc.js";import b from"./OrgTree.23adb187.js";import{b as h}from"./index.d9d5a299.js";import{_ as j,c as v,s as x}from"./PersonalModal.d8d3b6f1.js";import y from"./index.cd7df55a.js";import S from"./index.9af54014.js";import{j as w,aJ as I,bW as C,br as R,bV as P,ay as O,b2 as T,by as M,b_ as _,cg as k,ch as B,ci as D,r as L,u as A,K as V,o as W,m as F,Q as H,n as z,Y as E,q as U,V as $,ah as N}from"./vendor.686fd1d4.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./useForm.ed657ed4.js";import"./index.44a64fe8.js";/* empty css              *//* empty css              */import"./uuid.2b29000c.js";import"./useWindowSizeFn.d82e06bf.js";import"./onMountedOrActivated.172ad1ec.js";/* empty css              */import"./useSortable.928c6068.js";/* empty css              *//* empty css              */import"./index.0c9671c6.js";/* empty css              *//* empty css              *//* empty css              */import"./download.755feeb8.js";import"./base64Conver.bb012c73.js";import"./index.ee1d6750.js";import"./useContentViewHeight.7797c6a9.js";/* empty css              */import"./Tree.vue_vue&type=style&index=0&lang.4ac4e64b.js";import"./useContextMenu.2be85cf6.js";import"./dept.4ecc2908.js";import"./company.6c2287db.js";import"./jobGrade.0d495a3d.js";import"./positionInfo.2ffa2069.js";import"./role.2cc3b1b8.js";import"./CompanyTree.3da58eb7.js";var q=w({name:"PersonalManagement",components:{BasicTable:r,Spin:I,Space:C,PageWrapper:g,OrgTree:b,PersonalModal:j,RoleSelector:y,PersonalSelector:S,TableAction:s,Avatar:R,Badge:P,Popconfirm:O,Tag:T,Image:M,DeleteOutlined:_,ManOutlined:k,WomanOutlined:B,UserOutlined:D},setup(){const[e,{openModal:o,setModalProps:n}]=h(),[t,{openModal:i,setModalProps:r}]=h(),[s,{openModal:g,setModalProps:b}]=h(),j=L({}),y=L({}),S=L(""),w=L(!1),I=L({}),[C,{reload:R,setLoading:P}]=d({title:"列表",api:c,columns:v,formConfig:{labelWidth:120,schemas:x,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},searchInfo:{showRoles:!0},size:"small",useSearchForm:!0,showIndexColumn:!1,bordered:!0,actionColumn:{width:120,title:"操作",dataIndex:"action",slots:{customRender:"action"}},beforeFetch:e=>{var o,n;let t={};return"1"===(null==(o=I.value)?void 0:o.sourceType)?t={companyId:A(I).id}:"2"===(null==(n=I.value)?void 0:n.sourceType)&&(t={deptId:A(I).id}),a(a({},e),t)}});function O(){var e,o;let n={};"1"===(null==(e=I.value)?void 0:e.sourceType)?n={companyId:A(I).id}:"2"===(null==(o=I.value)?void 0:o.sourceType)&&(n={deptId:A(I).id}),R({searchInfo:n})}return{registerTable:C,registerRoleModal:t,registerPersonalModal:s,registerModal:e,deleteRoleLoading:y,previewImage:S,previewImageVisible:w,previewImageHandle:function(e){e&&(S.value=e,w.value=!0)},previewImageVisibleChange:function(e,o){w.value=e},handleCreate:function(){let e={};A(I)&&("1"===A(I).sourceType?e={companyId:A(I).id}:"2"===A(I).sourceType&&(e={companyId:A(I).companyId,deptId:A(I).id})),o(!0,{isUpdate:!1,record:e}),n({title:"新增人员",bodyStyle:{padding:"0px",margin:"0px"},width:800,height:400})},handleEdit:function(e){o(!0,{record:e,isUpdate:!0}),n({title:"修改人员",bodyStyle:{padding:"0px",margin:"0px"},width:800,height:420})},confirmDeleteRole:function(e,o){y.value[e]=!0,f({personalId:e,roleId:o}).then((()=>{O()})).finally((()=>{y.value[e]=!1}))},cancelDeleteRole:function(){},handleSettingRoles:function(e){j.value=e,i(!0,{personalId:j.value.id}),r({title:`给【${e.name}(${e.code})】添加角色`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})},handleSettingLeader:function(e){j.value=e;let o=[];e.leaderCode&&e.leaderName&&o.push({id:e.id,code:e.leaderCode,name:e.leaderName}),g(!0,{selectorProps:{multiSelect:!1,selectedList:o}}),b({title:`给【${e.name}(${e.code})】设置领导`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})},handleDelete:function(e){m([e.id]).then((e=>{R()}))},handleSuccess:function(){R()},handleSettingRoleSuccess:function(e){return l(this,null,(function*(){const o=e.map((e=>({id:e.id})));yield p({personalId:A(j).id,roles:o}),O()}))},handleSettingLeaderSuccess:function(e){return l(this,null,(function*(){e&&e.length>0&&u({leaderCode:e[0].code,id:A(j).id}).then((()=>{O()})).finally((()=>{}))}))},handleSelect:function(e){I.value=e,O()},doSearch:function(){R()}}}});const G=E("新增"),J={class:"personal-roles"};q.render=function(e,o,n,t,i,a){const l=V("OrgTree"),r=V("a-button"),s=V("TableAction"),d=V("WomanOutlined"),c=V("ManOutlined"),p=V("UserOutlined"),u=V("Avatar"),m=V("Badge"),f=V("DeleteOutlined"),g=V("Popconfirm"),b=V("Tag"),h=V("Space"),j=V("Spin"),v=V("BasicTable"),x=V("Image"),y=V("PersonalModal"),S=V("RoleSelector"),w=V("PersonalSelector"),I=V("PageWrapper");return W(),F(I,{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex"},{default:H((()=>[z(l,{class:"w-1/4 xl:w-1/5",onSelect:e.handleSelect},null,8,["onSelect"]),z(v,{onRegister:e.registerTable,class:"w-3/4 xl:w-4/5"},{toolbar:H((()=>[z(r,{type:"primary",onClick:e.handleCreate},{default:H((()=>[G])),_:1},8,["onClick"])])),action:H((({record:o})=>[z(s,{actions:[{title:"修改",icon:"clarity:note-edit-line",onClick:e.handleEdit.bind(null,o)},{title:"删除",icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"是否确认删除",confirm:e.handleDelete.bind(null,o)}}],dropDownActions:[{label:"分配角色",title:"分配角色",icon:"ant-design:usergroup-add",onClick:e.handleSettingRoles.bind(null,o)},{title:"设置领导",label:"设置领导",icon:"ant-design:setting-outlined",onClick:e.handleSettingLeader.bind(null,o)}]},null,8,["actions","dropDownActions"])])),nameRender:H((({record:o})=>[z(m,null,{count:H((()=>[2===o.sex?(W(),F(d,{key:0,style:{color:"#f5222d","font-size":"12px"}})):(W(),F(c,{key:1,style:{color:"#1890ff","font-size":"12px"}}))])),default:H((()=>[z(u,{src:o.headImg,onClick:n=>e.previewImageHandle(o.headImg)},{icon:H((()=>[z(p)])),_:2},1032,["src","onClick"])])),_:2},1024),E(" "+U(o.name),1)])),rolesRender:H((({record:o})=>[z("div",J,[z(j,{spinning:!(!e.deleteRoleLoading||!e.deleteRoleLoading[o.id])&&e.deleteRoleLoading[o.id]},{default:H((()=>[z(h,null,{default:H((()=>[(W(!0),F($,null,N(o.roles,(n=>(W(),F(b,{class:"role-item"},{default:H((()=>[E(U(n.name)+" ",1),z(g,{title:"确定要删除吗?","ok-text":"确定","cancel-text":"取消",onConfirm:t=>e.confirmDeleteRole(o.id,n.id),onCancel:e.cancelDeleteRole},{default:H((()=>[z(f,{color:"error",style:{color:"#d9595b"}})])),_:2},1032,["onConfirm","onCancel"])])),_:2},1024)))),256))])),_:2},1024)])),_:2},1032,["spinning"])])])),_:1},8,["onRegister"]),z(x,{width:0,height:0,src:e.previewImage,preview:{visible:e.previewImageVisible,onVisibleChange:e.previewImageVisibleChange}},null,8,["src","preview"]),z(y,{onRegister:e.registerModal,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),z(S,{onRegister:e.registerRoleModal,onSuccess:e.handleSettingRoleSuccess},null,8,["onRegister","onSuccess"]),z(w,{onRegister:e.registerPersonalModal,onSuccess:e.handleSettingLeaderSuccess},null,8,["onRegister","onSuccess"])])),_:1})};export default q;
