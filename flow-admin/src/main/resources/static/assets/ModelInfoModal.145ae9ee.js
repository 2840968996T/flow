var Q=Object.defineProperty;var O=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var U=(e,s,t)=>s in e?Q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,J=(e,s)=>{for(var t in s||(s={}))X.call(s,t)&&U(e,t,s[t]);if(O)for(var t of O(s))ee.call(s,t)&&U(e,t,s[t]);return e};var S=(e,s,t)=>new Promise((l,m)=>{var w=r=>{try{g(t.next(r))}catch(F){m(F)}},p=r=>{try{g(t.throw(r))}catch(F){m(F)}},g=r=>r.done?l(r.value):Promise.resolve(r.value).then(w,p);g((t=t.apply(e,s)).next())});import{bU as oe,dO as j,az as te,a as se,D as ae,c9 as ne,w as f,j as d,an as le,h as ie,a9 as re,aB as D,o as ue,k as de,B as y,n as c,t as W,p as B,C as b,y as K,z as N,aC as me,G as fe}from"./index.e1964776.js";import{B as ce,a as pe}from"./index.88470e0c.js";import{B as ge}from"./BasicForm.e5f615e6.js";import{u as Fe}from"./useForm.0cbae54a.js";import{T as Be}from"./index.1b277829.js";import{c as $,g as ve,e as ye}from"./modelInfo.2d391637.js";import{a as we}from"./app.da06e2da.js";import{R as P}from"./index.25019af6.js";import he from"./index.7ad660ce.js";const Le=[{title:"\u540D\u79F0",dataIndex:"name",align:"left"},{title:"KEY",dataIndex:"modelKey",width:100,align:"left"},{title:"\u5206\u7C7B\u540D\u79F0",dataIndex:"categoryName",width:100,align:"left"},{title:"\u7CFB\u7EDF",dataIndex:"appName",width:100,align:"left"},{title:"\u5E94\u7528\u8303\u56F4",dataIndex:"appliedRangeName",width:100,align:"left"},{title:"\u72B6\u6001",dataIndex:"statusName",width:70,align:"center",customRender:({record:e})=>{const{status:s,statusName:t}=e;var l="";return~~s===2?l="warning":~~s===3?l="success":~~s===4?l="error":l="gray",oe(Be,{color:l},()=>t)}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updateTime",width:120,align:"left"}],qe=[{field:"keyword",label:"\u5173\u952E\u5B57",component:"Input",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0/\u7F16\u7801"},labelWidth:60,colProps:{span:6,lg:{span:6,offset:0},sm:{span:10,offset:0},xs:{span:16,offset:0}}},{field:"appSn",label:"\u7CFB\u7EDF",component:"Select",labelWidth:60,colProps:{span:6,lg:{span:6,offset:0},sm:{span:10,offset:0},xs:{span:16,offset:0}}}],De=[{field:"id",label:"ID",required:!1,component:"Input",show:!1},{field:"appSn",label:"\u6240\u5C5E\u7CFB\u7EDF",component:"Select",componentProps:{getPopupContainer:()=>document.body},required:!0,colProps:{span:24}}],_e=e=>j.get({url:"/flow/form/formInfo/getFormInfoByModelKey?modelKey="+e}),Ie=e=>j.post({url:"/flow/form/formInfo/saveOrUpdate",params:e},{isReturnNativeResponse:!0});const{createMessage:A}=fe(),Ee=se({name:"ModelInfoModal",components:{FramePage:he,Button:ae,CloseOutlined:ne,BasicModal:ce,BasicForm:ge,Radio:P,RadioGroup:P.Group,RadioButton:P.Button},emits:["success","register"],setup(e,{emit:s}){const t=f(!1),l=f({}),m=f({}),w=f("formDesigner"),p=f(""),g=f(""),r=f(),F=f(),_=f(!1),[R,{setFieldsValue:C,updateSchema:k,resetFields:x,validate:G}]=Fe({labelWidth:100,schemas:De,showActionButtonGroup:!1,showResetButton:!1,submitButtonOptions:{text:"\u4FDD\u5B58"},actionColOptions:{span:14}}),V=o=>[{trigger:"blur",validator:(u,n)=>n?ye({id:o.id,field:o.field,fieldValue:n,fieldName:o.fieldName}).then(i=>i?Promise.resolve():Promise.reject(o.fieldName+"\u5DF2\u5B58\u5728\uFF0C\u8BF7\u4FEE\u6539\uFF01")).catch(i=>Promise.reject(i)):Promise.resolve()}];function z(o,u){const{data:{success:n,msg:i,data:E}}=o,{data:{success:h,msg:v,data:a}}=u;i&&h?(A.success({content:v,style:{marginTop:"10vh"}}),m.value=E,l.value={id:a.id,modelKey:a.code,modelName:a.name,formJson:a.formJson}):A.error(n?v:i)}window.submitFormInfo=o=>{var h;const{id:u,categoryCode:n}=d(m),i={id:(h=d(l))==null?void 0:h.id,code:o.modelKey,name:o.modelName,title:o.modelName,formJson:o.formJson,categoryCode:n},E={id:u,modelKey:o.modelKey,name:o.modelName,categoryCode:n};Promise.all([$(E),Ie(i)]).then(([v,a])=>{z(v,a)})};const[L,{setModalProps:M,changeLoading:I,closeModal:q}]=pe(o=>S(this,null,function*(){x(),_.value=!1,M({confirmLoading:!1}),t.value=!!(o!=null&&o.isUpdate),I(!0);let u=null;w.value="formDesigner";const{modelKey:n,name:i,categoryCode:E,modelId:h}=o.record;if(m.value=o.record,g.value="/form-making/index.html?isDev=true&modelKey="+h,l.value={modelKey:n,modelName:i,formJson:"",categoryCode:E},n){const a=yield _e(n);a&&(l.value={id:a.id,modelKey:a.code,modelName:a.name,formJson:a.formJson})}le(()=>{setTimeout(()=>{var T;const a=d(d(r).frameRef);a&&((T=a.contentWindow)!=null&&T.vueObj&&a.contentWindow.CustomForm.loadFormInfo(d(l)),a.onload=function(){a.contentWindow.CustomForm.loadFormInfo(d(l))})},0)});try{u=yield we()}finally{I(!1)}let v=o.record;yield k([{field:"appSn",componentProps:{options:u,labelField:"id"}},{field:"modelKey",dynamicRules:()=>[{required:!0,whitespace:!0,message:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01"},{pattern:new RegExp("^[a-zA-Z_]{1,}[0-9a-zA-Z_]{1,}$"),type:"string",message:"\u8BF7\u8F93\u5165\u82F1\u6587\u6216\u6570\u5B57\u4E14\u4EE5\u82F1\u6587\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF01"},{max:150,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E150\uFF01"},...V({id:d(t)&&v&&v.id||"",field:"modelKey",fieldValue:"",fieldName:"\u7F16\u7801"})]}]),C(J({},o.record))})),Z=ie(()=>d(t)?"\u7F16\u8F91":"\u65B0\u589E");function H(){q()}re(w,(o,u)=>{const{modelId:n}=m.value;if(o==="flowDesigner"){if(!_.value){I(!0),p.value="/flow-bpmn/index.html/#/bpmn/designer?modelId="+n;const i=d(d(F).frameRef);setTimeout(()=>{i.contentWindow.location.reload(!0),I(!1)},100)}_.value=!0}else o==="baseSetting"&&ve(n).then(i=>{i.version>0&&k({field:"appSn",componentProps:{disabled:!0},helpMessage:"\u5DF2\u53D1\u5E03\u7684\u6D41\u7A0B\u4E0D\u5141\u8BB8\u4FEE\u6539\u6240\u5C5E\u7CFB\u7EDF\uFF01"})})});function Y(){return S(this,null,function*(){try{M({confirmLoading:!0});const o=yield G(),u=yield $(o),{data:{msg:n,success:i}}=u;A.success(n)}finally{I(!1),M({confirmLoading:!1})}})}return{registerModal:L,registerForm:R,flowDesignerUrl:p,formDesignerUrl:g,flowDesignerRef:F,formDesignerRef:r,getTitle:Z,activityKey:w,flowBaseInfo:m,isUpdate:t,handleCloseModal:H,handleSubmit:Y}}}),be={class:"flow-form-title"},Re={class:"title"},Ce={class:"ctrl"},Me=c("div",{class:"close"},null,-1),Se={class:"designer-container form"},Ke={class:"designer-container flow"},Ne={class:"designer-container setting"},Pe={style:{width:"800px",margin:"auto"}},Ae={class:"mt-4 text-center"};function ke(e,s,t,l,m,w){const p=D("RadioButton"),g=D("RadioGroup"),r=D("FramePage"),F=D("BasicForm"),_=D("Button"),R=D("BasicModal");return ue(),de(R,me({wrapClassName:"form-flow-designer"},e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit,onCancel:e.handleCloseModal}),{title:y(()=>[c("div",be,[c("div",Re,W(e.isUpdate?"\u7F16\u8F91\u6D41\u7A0B":"\u521B\u5EFA\u6D41\u7A0B")+"- "+W(e.flowBaseInfo.name),1),c("div",Ce,[B(g,{value:e.activityKey,"onUpdate:value":s[0]||(s[0]=C=>e.activityKey=C),buttonStyle:"solid"},{default:y(()=>[B(p,{value:"formDesigner"},{default:y(()=>[b(" \u8868\u5355\u8BBE\u8BA1 ")]),_:1}),B(p,{disabled:!e.flowBaseInfo.id,value:"flowDesigner"},{default:y(()=>[b(" \u6D41\u7A0B\u8BBE\u8BA1 ")]),_:1},8,["disabled"]),B(p,{disabled:!e.flowBaseInfo.id,value:"baseSetting"},{default:y(()=>[b(" \u6269\u5C55\u8BBE\u7F6E ")]),_:1},8,["disabled"])]),_:1},8,["value"])]),Me])]),default:y(()=>[K(c("div",Se,[B(r,{ref:"formDesignerRef",frameSrc:e.formDesignerUrl},null,8,["frameSrc"])],512),[[N,e.activityKey==="formDesigner"]]),K(c("div",Ke,[B(r,{ref:"flowDesignerRef",frameSrc:e.flowDesignerUrl},null,8,["frameSrc"])],512),[[N,e.activityKey==="flowDesigner"]]),K(c("div",Ne,[c("div",Pe,[B(F,{onRegister:e.registerForm},null,8,["onRegister"]),c("div",Ae,[B(_,{onClick:e.handleSubmit,type:"primary"},{default:y(()=>[b("\u4FDD\u5B58")]),_:1},8,["onClick"])])])],512),[[N,e.activityKey==="baseSetting"]])]),_:1},16,["onRegister","title","onOk","onCancel"])}var Te=te(Ee,[["render",ke]]),Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"}));export{Te as M,Ze as a,Le as c,qe as s};
