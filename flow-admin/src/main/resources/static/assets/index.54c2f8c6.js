import{k as e,ad as o,b2 as n,cg as a,cb as t,bO as r,r as s,u as i,K as l,o as d,n as c,Q as p,q as m,Y as u}from"./vendor.9d9efc92.js";/* empty css              *//* empty css              *//* empty css              */import{_ as f}from"./TableImg.840b2332.js";import{f as h}from"./BasicForm.d12ec528.js";import{u as g}from"./useTable.14907d98.js";import{g as b,a as j,d as x,b as S}from"./role.05583b83.js";import{_ as P}from"./PageWrapper.0a593267.js";import w from"./CompanyTree.0cea8740.js";import{g as C}from"./index.68bdfa67.js";import{b as y}from"./useModal.40813107.js";import{_ as T,s as v,c as I,p as R}from"./RoleModal.cf6a0802.js";import M from"./index.d1cdbdbe.js";import{b as k}from"./personal.e4b15fc3.js";/* empty css              *//* empty css              */import"./useForm.831c770a.js";/* empty css              *//* empty css              */import"./uuid.c53863e7.js";import"./useWindowSizeFn.0534066c.js";import"./onMountedOrActivated.b73559bc.js";/* empty css              */import"./useSortable.86f4c026.js";import"./useExpose.0886c4eb.js";/* empty css              *//* empty css              *//* empty css              */import"./CountdownInput.69c99d5f.js";/* empty css              *//* empty css              */import"./download.684fb6a2.js";import"./StrengthMeter.e21abcab.js";import"./usePageContext.a9e23595.js";/* empty css              *//* empty css              */import"./Tree.vue_vue&type=style&index=0&lang.e79165c2.js";import"./useContextMenu.edb2fdbf.js";import"./company.63608d54.js";import"./OrgTree.5c79f156.js";import"./dept.0e3de0db.js";const{createMessage:_}=C();var A=e({name:"RoleManagement",components:{BasicTable:f,PageWrapper:P,CompanyTree:w,RoleModal:T,PersonalSelector:M,TableAction:h,Input:o,Tag:n,Affix:a,Space:t,Search:o.Search,SettingOutlined:r},setup(){const[e,{openModal:o}]=y(),[n,{openModal:a,setModalProps:t}]=y(),r=s({}),l=s([]),d=s({}),c=s({});v.forEach((e=>{e&&(e.componentProps.onkeypress=e=>{13===e.keyCode&&m()})}));const[p,{reload:m}]=g({title:"列表",api:b,columns:I,formConfig:{labelWidth:120,schemas:v,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},expandRowByClick:!0,useSearchForm:!0,showIndexColumn:!1,showTableSetting:!1,bordered:!1,pagination:!0,onExpand:(e,o)=>{e?(r.value=o,d.value[o.id]="",u(o.id,d.value[o.id])):l.value=[]},rowKey:"id",canResize:!1});function u(e,o){j({roleId:e,personal:{keyword:o||""}}).then((o=>{c.value[e]=o}))}return{personalColumns:R,currentRole:r,rolePersonalData:c,onSearchPerson:function(e,o){u(e,o)},searchPersonTxt:d,registerTable:p,registerModal:e,registerPersonalModal:n,handleCreate:function(){o(!0,{isUpdate:!1})},handleEdit:function(e,n){n.stopPropagation(),o(!0,{record:e,isUpdate:!0})},handleAddPersonal:function(e,o){o.stopPropagation(),r.value=e,j({roleId:e.id}).then((o=>{a(!0,{selectorProps:{multiSelect:!0,selectedList:o.map((e=>({code:e.code,name:e.name})))}}),t({title:`设置角色【${e.name}】下的人员`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})})).finally((()=>{}))},handleDelete:function(e){e.children&&e.children.length>0?_.warning("有子节点，不能删除！"):x([e.id]).then((e=>{m()}))},handleDeletePersonal:function(e){k({roleId:e.roleId,personalId:e.personalId}).then((()=>{u(e.roleId,"")}))},handleSuccess:function(){m()},handleSettingPersonalSuccess:function(e){const o=e.map((e=>({id:e.id,code:e.code})));S({roleId:i(r).id,personalList:o}).then((()=>{l.value=[i(r).id],u(i(r).id,d.value[i(r).id])}))},handleSelect:function(e){m({searchInfo:{companyId:e?e.id:""}})}}}});const B=u("新增"),F=u(" 姓名 "),O={class:"manager-range",style:{"text-align":"right"}},z=u("中国石化"),D=u("中国石化");A.render=function(e,o,n,a,t,r){const s=l("CompanyTree"),i=l("Affix"),u=l("a-button"),f=l("TableAction"),h=l("Search"),g=l("Tag"),b=l("Space"),j=l("SettingOutlined"),x=l("BasicTable"),S=l("RoleModal"),P=l("PersonalSelector"),w=l("PageWrapper");return d(),c(w,{dense:"",contentFullHeight:"",contentClass:"flex"},{default:p((()=>[m(i,{"offset-top":"8",class:"w-1/4 xl:w-1/5"},{default:p((()=>[m(s,{contentFullHeight:"",onSelect:e.handleSelect},null,8,["onSelect"])])),_:1}),m(x,{onRegister:e.registerTable,class:"personal w-3/4 xl:w-4/5"},{toolbar:p((()=>[m(u,{type:"primary",onClick:e.handleCreate},{default:p((()=>[B])),_:1},8,["onClick"])])),action:p((({record:o})=>[m(f,{actions:[{title:"添加人员",icon:"ant-design:user-add",onClick:e.handleAddPersonal.bind(null,o)},{title:"修改",icon:"clarity:note-edit-line",onClick:e.handleEdit.bind(null,o)},{title:"删除",icon:"ant-design:delete-outlined",color:"error",onClick:e=>{e.stopPropagation()},popConfirm:{title:"是否确认删除",confirm:e.handleDelete.bind(null,o)}}]},null,8,["actions"])])),expandedRowRender:p((({record:o,index:n,indent:a,expanded:t})=>[m(x,{title:"",size:"small",columns:e.personalColumns,useSearchForm:!1,immediate:!1,showIndexColumn:!0,showTableSetting:!1,bordered:!0,pagination:!1,actionColumn:"{\r\n            align: 'center'\r\n          }",rowKey:"id",canResize:!1,searchInfo:{roleId:o.id},dataSource:e.rolePersonalData[o.id],class:"w-4/4 xl:w-5/5"},{customName:p((({rec:n})=>[m("span",null,[F,m(h,{value:e.searchPersonTxt[o.id],"onUpdate:value":n=>e.searchPersonTxt[o.id]=n,placeholder:"姓名/工号/手机",style:{width:"150px"},size:"small",allowClear:"",onSearch:n=>{e.onSearchPerson(o.id,n)}},null,8,["value","onUpdate:value","onSearch"])])])),action:p((({record:o})=>[m(f,{actions:[{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"是否确认删除",confirm:e.handleDeletePersonal.bind(null,o)}}]},null,8,["actions"])])),setManagerRange:p((({record:e})=>[m("div",O,[m(b,{size:"small"},{default:p((()=>[m(g,{color:"processing"},{default:p((()=>[z])),_:1}),m(g,{color:"processing"},{default:p((()=>[D])),_:1})])),_:1}),m(j,{class:"ant-btn-link"})])])),_:2},1032,["columns","searchInfo","dataSource"])])),_:1},8,["onRegister"]),m(S,{onRegister:e.registerModal,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),m(P,{onRegister:e.registerPersonalModal,onSuccess:e.handleSettingPersonalSuccess},null,8,["onRegister","onSuccess"])])),_:1})};export default A;
