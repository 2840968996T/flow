import{az as O,a as $,I as k,w as _,aB as a,o as A,k as I,B as l,p as t,C,l as U,n as M,j as B,G as V}from"./index.da587afe.js";import{T as W}from"./index.9d0fc194.js";import{S as K}from"./index.5d1da0c4.js";import{A as L}from"./index.73e1db11.js";import{B as H,S as j}from"./TableImg.00c4ed04.js";import{l as G}from"./BasicForm.51e3eb56.js";import{u as J}from"./useTable.412b054f.js";import{g as q,a as x,d as Q,b as X}from"./role.4e796056.js";import{P as Y}from"./index.c0d22213.js";import Z from"./CompanyTree.a8cd8525.js";import{b as z}from"./index.e8eb4b57.js";import{R as ee,s as N,c as oe,p as ne}from"./RoleModal.153abd55.js";import te from"./index.4c429cb0.js";import{b as ae}from"./personal.275a0672.js";import"./useFlexGapSupport.caa26b6d.js";import"./throttleByAnimationFrame.4b37e265.js";import"./index.492229cd.js";import"./Checkbox.9d75a86f.js";import"./index.5aab84c4.js";import"./index.a85fa86f.js";import"./eagerComputed.3bbb876f.js";import"./useForm.d201bd46.js";import"./index.447b3242.js";import"./index.d7c8b760.js";import"./uuid.2b29000c.js";import"./index.3c9c3a6f.js";import"./_baseIteratee.78d8c020.js";import"./get.40c34cfc.js";import"./DeleteOutlined.690086a4.js";import"./index.d1cda802.js";import"./useRefs.1aead304.js";import"./Form.f8b72655.js";import"./Col.4ac749bb.js";import"./useSize.dbee3c08.js";import"./useWindowSizeFn.3fdab581.js";import"./index.a64c8a60.js";import"./sortable.esm.c081a59d.js";import"./RedoOutlined.46184af0.js";import"./FullscreenOutlined.3d903e0f.js";import"./index.813f510f.js";import"./fromPairs.daf93cb7.js";import"./scrollTo.37d32e36.js";import"./index.176a852f.js";/* empty css              *//* empty css               */import"./index.b3a5d1df.js";import"./transButton.1d3b575b.js";import"./index.72d53e09.js";import"./download.75f04d3f.js";import"./base64Conver.08b9f4ec.js";import"./index.9912aa68.js";import"./index.36675b6e.js";import"./uniqBy.f906dabc.js";import"./index.a0d7e8a1.js";import"./index.6d85aa5b.js";import"./useContentViewHeight.f2db75e2.js";import"./ArrowLeftOutlined.8a04d10c.js";import"./index.25a87437.js";import"./index.df7d8c48.js";import"./useContextMenu.0239c62a.js";import"./company.2076c16b.js";import"./constantEnum.bf6653fb.js";import"./OrgTree.8c395338.js";import"./dept.d887b272.js";const{createMessage:le}=V(),re=$({name:"RoleManagement",components:{BasicTable:H,PageWrapper:Y,CompanyTree:Z,RoleModal:ee,PersonalSelector:te,TableAction:G,Input:k,Tag:W,Affix:L,Space:K,Search:k.Search,SettingOutlined:j},setup(){const[n,{openModal:b}]=z(),[F,{openModal:v,setModalProps:D}]=z(),i=_({}),d=_([]),u=_({}),f=_({});N.forEach(e=>{e&&(e.componentProps.onkeypress=o=>{o.keyCode===13&&p()})});const[h,{reload:p}]=J({title:"\u5217\u8868",api:q,columns:oe,formConfig:{labelWidth:120,schemas:N,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},expandRowByClick:!0,useSearchForm:!0,showIndexColumn:!1,showTableSetting:!1,bordered:!1,pagination:!0,onExpand:(e,o)=>{e?(i.value=o,u.value[o.id]="",c(o.id,u.value[o.id])):d.value=[]},rowKey:"id",canResize:!1});function g(){b(!0,{isUpdate:!1})}function y(e,o){o.stopPropagation(),b(!0,{record:e,isUpdate:!0})}function c(e,o){x({roleId:e,personal:{keyword:o||""}}).then(r=>{f.value[e]=r})}function S(e,o){o.stopPropagation(),i.value=e,x({roleId:e.id}).then(r=>{v(!0,{selectorProps:{multiSelect:!0,selectedList:r.map(E=>({code:E.code,name:E.name}))}}),D({title:`\u8BBE\u7F6E\u89D2\u8272\u3010${e.name}\u3011\u4E0B\u7684\u4EBA\u5458`,bodyStyle:{padding:"0px",margin:"0px"},width:850,height:450,showOkBtn:!0,showCancelBtn:!1})}).finally(()=>{})}function w(e){if(e.children&&e.children.length>0){le.warning("\u6709\u5B50\u8282\u70B9\uFF0C\u4E0D\u80FD\u5220\u9664\uFF01");return}Q([e.id]).then(o=>{p()})}function R(e){ae({roleId:e.roleId,personalId:e.personalId}).then(()=>{c(e.roleId,"")})}function T(){setTimeout(()=>{p()},200)}function s(e,o){c(e,o)}function m(e){JSON.stringify(e);const o=e.map(r=>({id:r.id,code:r.code}));X({roleId:B(i).id,personalList:o}).then(()=>{d.value=[B(i).id],c(B(i).id,u.value[B(i).id])})}function P(e){p({searchInfo:{companyId:e?e.id:""}})}return{personalColumns:ne,currentRole:i,rolePersonalData:f,onSearchPerson:s,searchPersonTxt:u,registerTable:h,registerModal:n,registerPersonalModal:F,handleCreate:g,handleEdit:y,handleAddPersonal:S,handleDelete:w,handleDeletePersonal:R,handleSuccess:T,handleSettingPersonalSuccess:m,handleSelect:P}}}),se={class:"manager-range",style:{"text-align":"right"}};function ie(n,b,F,v,D,i){const d=a("CompanyTree"),u=a("Affix"),f=a("a-button"),h=a("TableAction"),p=a("Search"),g=a("Tag"),y=a("Space"),c=a("SettingOutlined"),S=a("BasicTable"),w=a("RoleModal"),R=a("PersonalSelector"),T=a("PageWrapper");return A(),I(T,{dense:"",contentFullHeight:"",contentClass:"flex"},{default:l(()=>[t(u,{"offset-top":"8",class:"w-1/4 xl:w-1/5"},{default:l(()=>[t(d,{contentFullHeight:"",onSelect:n.handleSelect},null,8,["onSelect"])]),_:1}),t(S,{onRegister:n.registerTable,class:"personal w-3/4 xl:w-4/5"},{toolbar:l(()=>[t(f,{type:"primary",onClick:n.handleCreate},{default:l(()=>[C("\u65B0\u589E")]),_:1},8,["onClick"])]),bodyCell:l(({column:s,record:m})=>[s.key==="action"?(A(),I(h,{key:0,actions:[{tooltip:"\u6DFB\u52A0\u4EBA\u5458",icon:"ant-design:user-add",onClick:n.handleAddPersonal.bind(null,m)},{tooltip:"\u4FEE\u6539",icon:"clarity:note-edit-line",onClick:n.handleEdit.bind(null,m)},{tooltip:"\u5220\u9664",icon:"ant-design:delete-outlined",color:"error",onClick:P=>{P.stopPropagation()},popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664",confirm:n.handleDelete.bind(null,m),placement:"left"}}]},null,8,["actions"])):U("",!0)]),expandedRowRender:l(({record:s,index:m,indent:P,expanded:e})=>[t(S,{title:"",size:"small",columns:n.personalColumns,useSearchForm:!1,immediate:!1,showIndexColumn:!0,showTableSetting:!1,bordered:!0,pagination:!1,actionColumn:`{
              align: 'center'
            }`,rowKey:"id",canResize:!1,searchInfo:{roleId:s.id},dataSource:n.rolePersonalData[s.id],class:"w-4/4 xl:w-5/5"},{customName:l(({rec:o})=>[M("span",null,[C(" \u59D3\u540D "),t(p,{value:n.searchPersonTxt[s.id],"onUpdate:value":r=>n.searchPersonTxt[s.id]=r,placeholder:"\u59D3\u540D/\u5DE5\u53F7/\u624B\u673A",style:{width:"150px"},size:"small",allowClear:"",onSearch:r=>{n.onSearchPerson(s.id,r)}},null,8,["value","onUpdate:value","onSearch"])])]),action:l(({record:o})=>[t(h,{actions:[{icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"\u662F\u5426\u786E\u8BA4\u5220\u9664",confirm:n.handleDeletePersonal.bind(null,o),placement:"left"}}]},null,8,["actions"])]),setManagerRange:l(({record:o})=>[M("div",se,[t(y,{size:"small"},{default:l(()=>[t(g,{color:"processing"},{default:l(()=>[C("\u4E2D\u56FD\u77F3\u5316")]),_:1}),t(g,{color:"processing"},{default:l(()=>[C("\u4E2D\u56FD\u77F3\u5316")]),_:1})]),_:1}),t(c,{class:"ant-btn-link"})])]),_:2},1032,["columns","searchInfo","dataSource"])]),_:1},8,["onRegister"]),t(w,{onRegister:n.registerModal,onSuccess:n.handleSuccess},null,8,["onRegister","onSuccess"]),t(R,{onRegister:n.registerPersonalModal,onSuccess:n.handleSettingPersonalSuccess},null,8,["onRegister","onSuccess"])]),_:1})}var Co=O(re,[["render",ie]]);export{Co as default};
