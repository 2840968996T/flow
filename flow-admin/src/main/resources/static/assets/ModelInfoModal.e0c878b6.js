var te=Object.defineProperty;var W=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var $=(e,s,t)=>s in e?te(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,j=(e,s)=>{for(var t in s||(s={}))se.call(s,t)&&$(e,t,s[t]);if(W)for(var t of W(s))ne.call(s,t)&&$(e,t,s[t]);return e};var A=(e,s,t)=>new Promise((n,d)=>{var y=l=>{try{p(t.next(l))}catch(g){d(g)}},c=l=>{try{p(t.throw(l))}catch(g){d(g)}},p=l=>l.done?n(l.value):Promise.resolve(l.value).then(y,c);p((t=t.apply(e,s)).next())});import{bU as ae,dO as V,az as le,a as ie,D as re,c9 as ue,w as m,j as u,an as de,h as me,a9 as fe,aB as h,o as ce,k as pe,B as v,n as f,t as x,p as B,C as M,y as T,z as k,aC as ge,G as Fe}from"./index.7ea10544.js";import{B as Be,a as ve}from"./index.61c914e7.js";import{B as ye}from"./BasicForm.d977d74c.js";import{u as he}from"./useForm.d5452096.js";import{T as we}from"./index.6954dcaa.js";import{c as G,g as De,e as _e}from"./modelInfo.116e9d32.js";import{a as Ie}from"./app.3ec8decb.js";import{R as O}from"./index.e5a472bb.js";import Ee from"./index.6d81d2cb.js";const Ye=[{title:"\u540D\u79F0",dataIndex:"name",align:"left"},{title:"KEY",dataIndex:"modelKey",width:100,align:"left"},{title:"\u5206\u7C7B\u540D\u79F0",dataIndex:"categoryName",width:100,align:"left"},{title:"\u7CFB\u7EDF",dataIndex:"appName",width:100,align:"left"},{title:"\u5E94\u7528\u8303\u56F4",dataIndex:"appliedRangeName",width:100,align:"left"},{title:"\u72B6\u6001",dataIndex:"statusName",width:70,align:"center",customRender:({record:e})=>{const{status:s,statusName:t}=e;var n="";return~~s===2?n="warning":~~s===3?n="success":~~s===4?n="error":n="gray",ae(we,{color:n},()=>t)}},{title:"\u66F4\u65B0\u65F6\u95F4",dataIndex:"updateTime",width:120,align:"left"}],Qe=[{field:"keyword",label:"\u5173\u952E\u5B57",component:"Input",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0/\u7F16\u7801"},labelWidth:60,colProps:{span:6,lg:{span:6,offset:0},sm:{span:10,offset:0},xs:{span:16,offset:0}}},{field:"appSn",label:"\u7CFB\u7EDF",component:"Select",labelWidth:60,colProps:{span:6,lg:{span:6,offset:0},sm:{span:10,offset:0},xs:{span:16,offset:0}}}],be=[{field:"id",label:"ID",required:!1,component:"Input",show:!1},{field:"appSn",label:"\u6240\u5C5E\u7CFB\u7EDF",component:"Select",componentProps:{getPopupContainer:()=>document.body},required:!0,colProps:{span:24}}],Re=e=>V.get({url:"/flow/form/formInfo/getFormInfoByModelKey?modelKey="+e}),Ce=e=>V.post({url:"/flow/form/formInfo/saveOrUpdate",params:e},{isReturnNativeResponse:!0});const{createMessage:_}=Fe(),Me=ie({name:"ModelInfoModal",components:{FramePage:Ee,Button:re,CloseOutlined:ue,BasicModal:Be,BasicForm:ye,Radio:O,RadioGroup:O.Group,RadioButton:O.Button},emits:["success","register"],setup(e,{emit:s}){const t=m(!1),n=m({}),d=m({}),y=m("formDesigner"),c=m(""),p=m(""),l=m(),g=m(),w=m(!1),[S,{setFieldsValue:I,updateSchema:K,resetFields:z,validate:L}]=he({labelWidth:100,schemas:be,showActionButtonGroup:!1,showResetButton:!1,submitButtonOptions:{text:"\u4FDD\u5B58"},actionColOptions:{span:14}}),q=o=>[{trigger:"blur",validator:(F,a)=>a?_e({id:o.id,field:o.field,fieldValue:a,fieldName:o.fieldName}).then(i=>i?Promise.resolve():Promise.reject(o.fieldName+"\u5DF2\u5B58\u5728\uFF0C\u8BF7\u4FEE\u6539\uFF01")).catch(i=>Promise.reject(i)):Promise.resolve()}];window.submitFormInfo=o=>{var E;const{id:F,categoryCode:a}=u(d),i={id:(E=u(n))==null?void 0:E.id,code:o.modelKey,name:o.modelName,title:o.modelName,formJson:o.formJson,categoryCode:a},P={id:F,modelKey:o.modelKey,name:o.modelName,categoryCode:a};G(P).then(b=>{const{data:{success:r,msg:R,data:U}}=b;r?Ce(i).then(ee=>{const{data:{success:oe,msg:J,data:C}}=ee;oe?(_.success({content:J,style:{marginTop:"10vh"}}),d.value=U,n.value={id:C.id,modelKey:C.code,modelName:C.name,formJson:C.formJson},I({id:U.id})):_.error({content:J,style:{marginTop:"10vh"}})}):_.error({content:R,style:{marginTop:"10vh"}})})};const[Z,{setModalProps:N,changeLoading:D,closeModal:H}]=ve(o=>A(this,null,function*(){z(),w.value=!1,N({confirmLoading:!1}),t.value=!!(o!=null&&o.isUpdate),D(!0);let F=null;y.value="formDesigner";const{modelKey:a,name:i,categoryCode:P,modelId:E}=o.record;if(d.value=o.record,p.value="/form-making/index.html?isDev=true&modelKey="+E,n.value={modelKey:a,modelName:i,formJson:"",categoryCode:P},a){const r=yield Re(a);r&&(n.value={id:r.id,modelKey:r.code,modelName:r.name,formJson:r.formJson})}de(()=>{setTimeout(()=>{var R;const r=u(u(l).frameRef);r&&((R=r.contentWindow)!=null&&R.vueObj&&r.contentWindow.CustomForm.loadFormInfo(u(n)),r.onload=function(){r.contentWindow.CustomForm.loadFormInfo(u(n))})},0)});try{F=yield Ie()}finally{D(!1)}let b=o.record;yield K([{field:"appSn",componentProps:{options:F,labelField:"id"}},{field:"modelKey",dynamicRules:()=>[{required:!0,whitespace:!0,message:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01"},{pattern:new RegExp("^[a-zA-Z_]{1,}[0-9a-zA-Z_]{1,}$"),type:"string",message:"\u8BF7\u8F93\u5165\u82F1\u6587\u6216\u6570\u5B57\u4E14\u4EE5\u82F1\u6587\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF01"},{max:150,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E150\uFF01"},...q({id:u(t)&&b&&b.id||"",field:"modelKey",fieldValue:"",fieldName:"\u7F16\u7801"})]}]),I(j({},o.record))})),Y=me(()=>u(t)?"\u7F16\u8F91":"\u65B0\u589E");function Q(){H()}fe(y,(o,F)=>{const{modelId:a}=d.value;if(o==="flowDesigner"){if(!w.value){D(!0),c.value="/flow-bpmn/index.html/#/bpmn/designer?modelId="+a;const i=u(u(g).frameRef);setTimeout(()=>{i.contentWindow.location.reload(!0),D(!1)},100)}w.value=!0}else o==="baseSetting"&&De(a).then(i=>{i.version>0&&K({field:"appSn",componentProps:{disabled:!0},helpMessage:"\u5DF2\u53D1\u5E03\u7684\u6D41\u7A0B\u4E0D\u5141\u8BB8\u4FEE\u6539\u6240\u5C5E\u7CFB\u7EDF\uFF01"})})});function X(){return A(this,null,function*(){try{N({confirmLoading:!0});const o=yield L(),F=yield G(o),{data:{msg:a,success:i}}=F;i?(_.success({content:a,style:{marginTop:"10vh"}}),K({field:"appSn",componentProps:{disabled:!0}})):_.error({content:a,style:{marginTop:"10vh"}})}finally{D(!1),N({confirmLoading:!1})}})}return{registerModal:Z,registerForm:S,flowDesignerUrl:c,formDesignerUrl:p,flowDesignerRef:g,formDesignerRef:l,getTitle:Y,activityKey:y,flowBaseInfo:d,isUpdate:t,handleCloseModal:Q,handleSubmit:X}}}),Se={class:"flow-form-title"},Ke={class:"title"},Ne={class:"ctrl"},Pe=f("div",{class:"close"},null,-1),Ae={class:"designer-container form"},Te={class:"designer-container flow"},ke={class:"designer-container setting"},Oe={style:{width:"800px",margin:"auto"}},Ue={class:"mt-4 text-center"};function Je(e,s,t,n,d,y){const c=h("RadioButton"),p=h("RadioGroup"),l=h("FramePage"),g=h("BasicForm"),w=h("Button"),S=h("BasicModal");return ce(),pe(S,ge({wrapClassName:"form-flow-designer"},e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit,onCancel:e.handleCloseModal}),{title:v(()=>[f("div",Se,[f("div",Ke,x(e.isUpdate?"\u7F16\u8F91\u6D41\u7A0B":"\u521B\u5EFA\u6D41\u7A0B")+"- "+x(e.flowBaseInfo.name),1),f("div",Ne,[B(p,{value:e.activityKey,"onUpdate:value":s[0]||(s[0]=I=>e.activityKey=I),buttonStyle:"solid"},{default:v(()=>[B(c,{value:"formDesigner"},{default:v(()=>[M(" \u8868\u5355\u8BBE\u8BA1 ")]),_:1}),B(c,{disabled:!e.flowBaseInfo.id,value:"flowDesigner"},{default:v(()=>[M(" \u6D41\u7A0B\u8BBE\u8BA1 ")]),_:1},8,["disabled"]),B(c,{disabled:!e.flowBaseInfo.id,value:"baseSetting"},{default:v(()=>[M(" \u6269\u5C55\u8BBE\u7F6E ")]),_:1},8,["disabled"])]),_:1},8,["value"])]),Pe])]),default:v(()=>[T(f("div",Ae,[B(l,{ref:"formDesignerRef",frameSrc:e.formDesignerUrl},null,8,["frameSrc"])],512),[[k,e.activityKey==="formDesigner"]]),T(f("div",Te,[B(l,{ref:"flowDesignerRef",frameSrc:e.flowDesignerUrl},null,8,["frameSrc"])],512),[[k,e.activityKey==="flowDesigner"]]),T(f("div",ke,[f("div",Oe,[B(g,{onRegister:e.registerForm},null,8,["onRegister"]),f("div",Ue,[B(w,{onClick:e.handleSubmit,type:"primary"},{default:v(()=>[M("\u4FDD\u5B58")]),_:1},8,["onClick"])])])],512),[[k,e.activityKey==="baseSetting"]])]),_:1},16,["onRegister","title","onOk","onCancel"])}var We=le(Me,[["render",Je]]),Xe=Object.freeze(Object.defineProperty({__proto__:null,default:We},Symbol.toStringTag,{value:"Module"}));export{We as M,Xe as a,Ye as c,Qe as s};
