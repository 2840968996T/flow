var I=Object.defineProperty;var b=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var J=(e,a,t)=>a in e?I(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,C=(e,a)=>{for(var t in a||(a={}))R.call(a,t)&&J(e,t,a[t]);if(b)for(var t of b(a))V.call(a,t)&&J(e,t,a[t]);return e};var w=(e,a,t)=>new Promise((i,d)=>{var v=c=>{try{r(t.next(c))}catch(o){d(o)}},n=c=>{try{r(t.throw(c))}catch(o){d(o)}},r=c=>c.done?i(c.value):Promise.resolve(c.value).then(v,n);r((t=t.apply(e,a)).next())});import{B as x,a as F}from"./index.4ff668bf.js";import{P as W}from"./index.4dfdb4ab.js";import{az as z,a as j,b4 as q,e7 as G,x as f,a9 as D,fF as O,an as T,h as H,aB as g,bT as Q,i as k,l as B,C as E,p as U,j as X,G as Y,aE as Z,D as ee,t as te,m as le,q as K,z as se,aC as ae,k as re}from"./index.ef013507.js";import{T as oe}from"./index.0b0495b0.js";import{a as ie}from"./dept.e4282a57.js";import{_ as ne}from"./index.154de31a.js";import"./useWindowSizeFn.37be93ea.js";import"./FullscreenOutlined.d97e6502.js";import"./index.1eabbb9a.js";import"./index.0210df95.js";import"./useSize.55446702.js";import"./eagerComputed.487f958f.js";import"./useContentViewHeight.d02bb685.js";import"./ArrowLeftOutlined.5616a4a1.js";import"./index.412dcca9.js";import"./transButton.750f7635.js";import"./fromPairs.84aabb58.js";import"./index.4dfcf0e9.js";import"./useContextMenu.eed63f27.js";import"./index.8a7cb11f.js";import"./get.fbc063d7.js";const ce=j({props:{title:{type:String,default:"\u4EBA\u5458\u9009\u62E9"}},name:"OrgSelector",components:{BasicModal:x,PageWrapper:W,Tag:oe,BasicTree:ne,Spin:q,CloseCircleOutlined:G},setup(e,{emit:a}){const t=f([]),i=f(!1),d=f([]),v=f(!1),n=f([]),r=f([]),c=f(null);function o(){const l=re(c);if(!l)throw new Error("tree is null!");return l}D(r,(l,u)=>{if(i.value){const m=l.map(p=>{let s=O(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return s=C({},s),delete s.children,s});T(()=>{t.value=JSON.parse(JSON.stringify(m)),o().setCheckedKeys(l)})}else{const m=l.map(p=>{let s=O(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return s=C({},s),delete s.children,s});T(()=>{t.value=JSON.parse(JSON.stringify(m)),o().setSelectedKeys(l)})}},{immediate:!0,deep:!0}),D(n,(l,u)=>{if(!i.value){const m=l.map(p=>{let s=O(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return s=C({},s),delete s.children,s});T(()=>{t.value=JSON.parse(JSON.stringify(m)),o().setSelectedKeys(l)})}},{immediate:!0,deep:!0});const[y,{setModalProps:_,closeModal:S}]=F(l=>w(this,null,function*(){const{selectorProps:u}=l;v.value=!0,i.value=u.multiSelect,ie().then(m=>{d.value=m,u.selectedList;let p=u.selectedList.map(s=>s.id);i.value?(r.value=p,setTimeout(()=>{o().setCheckedKeys(r.value),o().setExpandedKeys(r.value)},200)):(n.value=p,setTimeout(()=>{o().setSelectedKeys(n.value),o().setExpandedKeys(n.value)},200))}).finally(()=>{v.value=!1}),_({wrapClassName:"selector-content"})}));function N(l){i.value?r.value=JSON.parse(JSON.stringify(l.checked)):r.value=JSON.parse(JSON.stringify(l.checked.length>0?[l.checked[0]]:[]))}function L(l){if(!i.value)n.value=l;else debugger}const M=H(()=>"\u9009\u62E9\u4EBA\u5458");function P(){i.value?r.value=[]:n.value=[]}function A(l){i.value?r.value.splice(r.value.findIndex(u=>u===l),1):n.value.splice(n.value.findIndex(u=>u===l),1)}function $(){a("success",t),S()}return{treeRef:c,multiSelect:i,treeData:d,treeLoading:v,registerModal:y,getTitle:M,selectedList:t,removeAllSelected:P,removeSelectedItem:A,handleSubmit:$,handleCheck:N,handleSelect:L}}}),de={class:"selected-items"};function ue(e,a,t,i,d,v){const n=g("Tag"),r=g("CloseCircleOutlined"),c=g("BasicTree"),o=g("PageWrapper"),y=g("BasicModal"),_=Q("loading");return k(),B(y,ae({wrapClassName:"selector-body org"},e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:E(()=>[U("div",de,[(k(!0),X(Y,null,Z(e.selectedList,S=>(k(),B(n,{color:"processing",closable:"",onClose:N=>{N.preventDefault(),e.removeSelectedItem(S.id)}},{default:E(()=>[ee(te(S.shortName),1)]),_:2},1032,["onClose"]))),256)),e.selectedList.length>0?(k(),B(r,{key:0,class:"close-all",title:"\u6E05\u7A7A",onClick:e.removeAllSelected},null,8,["onClick"])):le("",!0)]),K(o,{dense:"",contentClass:"flex"},{default:E(()=>[se(K(c,{ref:"treeRef",class:"w-4/4 org-tree",title:"\u7EC4\u7EC7",search:"",clickRowToExpand:!1,treeData:e.treeData,replaceFields:{key:"id",title:"shortName"},onCheck:e.handleCheck,onSelect:e.handleSelect,checkable:!!e.multiSelect,selectable:!e.multiSelect,checkStrictly:!0,autoExpandParent:""},null,8,["treeData","onCheck","onSelect","checkable","selectable"]),[[_,e.treeLoading]])]),_:1})]),_:1},16,["onRegister","title","onOk"])}var Me=z(ce,[["render",ue]]);export{Me as default};
