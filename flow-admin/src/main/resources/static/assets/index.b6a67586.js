import{_ as e}from"./TableImg.51b451b7.js";import{f as n}from"./BasicForm.e292c287.js";import{u as t}from"./useTable.d377fe38.js";import{g as o,c as i,s as r,a as s,b as a,d as l,p as d,e as c,f as p}from"./listener.data.4147b269.js";import u from"./ListenerModal.103c2922.js";import m from"./ListenerPropertiesModal.48e404af.js";import{b as f}from"./index.393263b2.js";import{j as b,r as h,I as g,K as j,o as x,m as y,n as v,Q as T,Y as S,q as C}from"./vendor.686fd1d4.js";/* empty css              *//* empty css              */import"./useForm.10272283.js";import"./index.f769efd5.js";/* empty css              *//* empty css              *//* empty css              */import"./uuid.2b29000c.js";import"./useWindowSizeFn.d82e06bf.js";import"./onMountedOrActivated.172ad1ec.js";/* empty css              */import"./useSortable.27d623ea.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index.9bee2b44.js";/* empty css              *//* empty css              *//* empty css              */import"./download.d628f07d.js";import"./base64Conver.bb012c73.js";import"./index.48620b65.js";var P=b({name:"FlowListener",components:{BasicTable:e,TableAction:n,ListenerModal:u,ListenerPropertiesModal:m},setup(){const[e,{openModal:n}]=f(),u=h({}),m=h({}),b=h({}),j=h(!1),x=h([]),y=h({}),[v,{openModal:T,setModalProps:S}]=f(),[C,{reload:P,getForm:w,setProps:R}]=t({title:"列表",api:o,columns:i,formConfig:{labelWidth:80,schemas:r,showAdvancedButton:!1,showResetButton:!1,autoSubmitOnEnter:!0},expandedRowKeys:x,expandRowByClick:!0,useSearchForm:!0,bordered:!0,showIndexColumn:!0,showTableSetting:!1,pagination:!1,rowKey:"id",canResize:!0,onExpand:(e,n)=>{e?(x.value=[n.id],y.value=n,M(n.id)):x.value=[]},resizeHeightOffset:-50});function M(e){j.value=!0,s({listenerId:e}).then((n=>{n&&n.length>0?u.value[e]=n:u.value[e]=[]})).finally((()=>{j.value=!1}))}return g((()=>{a().then((e=>{e.forEach((e=>{m.value[e.value]=e.label}))}));const{updateSchema:e}=w();l().then((n=>{n.forEach((e=>{b.value[e.value]=e.label})),e([{field:"listenerType",defaultValue:n[0].value,componentProps:{options:n,onChange:({target:e})=>{R({searchInfo:{listenerType:e.value}}),P()}}}])}))})),{registerTable:C,registerModal:e,registerPropertiesModal:v,expressionTypeObj:m,listenerTypeObj:b,propertiesColumns:d,listenerPropertiesData:u,propertiesTableLoading:j,handleDeleteProperty:function(e){p(e.id).then((()=>{M(y.value.id)})).finally((()=>{}))},handleCloseFunc:function(){return P(),Promise.resolve(!0)},handleCreate:function(){n(!0,{isUpdate:!1,record:{listenerType:"taskListener"}})},handleEditProperties:function(e){T(!0,{isUpdate:!0,record:e}),S({title:`修改【${e.name}】的属性`})},handleAddProperties:function(e,n){n.stopPropagation(),y.value=e,T(!0,{isUpdate:!1,record:{listenerId:e.id}}),S({title:`添加【${e.name}】的属性`})},handleEdit:function(e,t){t.stopPropagation(),n(!0,{record:e,isUpdate:!0})},handleDelete:function(e,n){n.stopPropagation(),c(e.id).then((()=>{P()}))},handleSuccess:function(){P()},handleUpdateSecretKeySuccess:function(){M(y.value.id),x.value=[y.value.id]}}}});const w=S(" 新增 ");P.render=function(e,n,t,o,i,r){const s=j("a-button"),a=j("TableAction"),l=j("BasicTable"),d=j("ListenerModal"),c=j("ListenerPropertiesModal");return x(),y("div",null,[v(l,{onRegister:e.registerTable,dense:"",contentFullHeight:"",fixedHeight:""},{toolbar:T((()=>[v(s,{type:"primary",onClick:e.handleCreate},{default:T((()=>[w])),_:1},8,["onClick"])])),action:T((({record:n})=>[v(a,{actions:[{icon:"ant-design:plus-outlined",title:"添加参数",onClick:e.handleAddProperties.bind(null,n)},{title:"修改",icon:"clarity:note-edit-line",onClick:e.handleEdit.bind(null,n)},{title:"删除",icon:"ant-design:delete-outlined",color:"error",popConfirm:{title:"是否确认删除",confirm:e.handleDelete.bind(null,n)}}]},null,8,["actions"])])),typeRender:T((({record:n})=>[S(C(e.expressionTypeObj[n.type]),1)])),listenerTypeRender:T((({record:n})=>[S(C(e.listenerTypeObj[n.listenerType]),1)])),expandedRowRender:T((({record:n,index:t,indent:o,expanded:i})=>[v(l,{title:"",size:"small",columns:e.propertiesColumns,useSearchForm:!1,immediate:!1,showIndexColumn:!0,showTableSetting:!1,bordered:!0,pagination:!1,emptyDataIsShowTable:!1,inset:!0,actionColumn:"{\n            align: 'center'\n          }",rowKey:"id",canResize:!1,loading:e.propertiesTableLoading,dataSource:e.listenerPropertiesData[n.id]},{action:T((({record:n})=>[v(a,{actions:[{icon:"clarity:note-edit-line",title:"编辑",onClick:e.handleEditProperties.bind(null,n)},{icon:"ant-design:delete-outlined",color:"error",title:"删除",popConfirm:{title:"是否确认删除",confirm:e.handleDeleteProperty.bind(null,n)}}]},null,8,["actions"])])),_:2},1032,["columns","loading","dataSource"])])),_:1},8,["onRegister"]),v(d,{onRegister:e.registerModal,onSuccess:e.handleSuccess},null,8,["onRegister","onSuccess"]),v(c,{onRegister:e.registerPropertiesModal,onSuccess:e.handleUpdateSecretKeySuccess,closeFunc:e.handleCloseFunc},null,8,["onRegister","onSuccess","closeFunc"])])};export default P;
