var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,r=(e,r)=>{for(var i in r||(r={}))a.call(r,i)&&s(e,i,r[i]);if(t)for(var i of t(r))l.call(r,i)&&s(e,i,r[i]);return e};import{_ as i,a as n}from"./useModal.b44b8cab.js";import{_ as o}from"./PageWrapper.ba7be9e5.js";import{k as c,b2 as d,aH as u,c8 as p,r as m,D as v,J as f,f as h,u as b,K as S,ar as g,o as y,n as O,Q as k,q as j,V as x,ah as C,Y as N,s as w,X as P,w as J,N as T}from"./vendor.bc3b2d68.js";/* empty css              */import{g as M}from"./dept.14b808a2.js";import{a_ as K}from"./index.33a0330f.js";import{_}from"./Tree.vue_vue&type=style&index=0&lang.5d1be1b0.js";import"./useWindowSizeFn.ade0e88c.js";import"./usePageContext.a11cc1be.js";/* empty css              *//* empty css              */import"./onMountedOrActivated.06aaefd7.js";import"./useContextMenu.4afbb1e4.js";/* empty css              */import"./useExpose.c4c32617.js";var E=c({props:{title:{type:String,default:"人员选择"}},name:"OrgSelector",components:{BasicModal:i,PageWrapper:o,Tag:d,BasicTree:_,Spin:u,CloseCircleOutlined:p},setup(e,{emit:t}){const a=m([]),l=m(!1),s=m([]),i=m(!1),o=m([]),c=m([]),d=m(null);function u(){const e=b(d);if(!e)throw new Error("tree is null!");return e}v(c,((e,t)=>{if(l.value){const t=e.map((e=>{let t=K(s.value,(t=>t.id===e),{id:"id",pid:"pid",children:"children"});return t=r({},t),delete t.children,t}));f((()=>{a.value=JSON.parse(JSON.stringify(t)),u().setCheckedKeys(e)}))}else{const t=e.map((e=>{let t=K(s.value,(t=>t.id===e),{id:"id",pid:"pid",children:"children"});return t=r({},t),delete t.children,t}));f((()=>{a.value=JSON.parse(JSON.stringify(t)),u().setSelectedKeys(e)}))}}),{immediate:!0,deep:!0}),v(o,((e,t)=>{if(!l.value){const t=e.map((e=>{let t=K(s.value,(t=>t.id===e),{id:"id",pid:"pid",children:"children"});return t=r({},t),delete t.children,t}));f((()=>{a.value=JSON.parse(JSON.stringify(t)),u().setSelectedKeys(e)}))}}),{immediate:!0,deep:!0});const[p,{setModalProps:S,closeModal:g}]=n((e=>{return t=this,a=null,r=function*(){const{selectorProps:t}=e;i.value=!0,l.value=t.multiSelect,M().then((e=>{s.value=e;let a=t.selectedList.map((e=>e.id));l.value?(c.value=a,setTimeout((()=>{u().setCheckedKeys(c.value),u().setExpandedKeys(c.value)}),200)):(o.value=a,setTimeout((()=>{u().setSelectedKeys(o.value),u().setExpandedKeys(o.value)}),200))})).finally((()=>{i.value=!1})),S({wrapClassName:"selector-content"})},new Promise(((e,l)=>{var s=e=>{try{n(r.next(e))}catch(t){l(t)}},i=e=>{try{n(r.throw(e))}catch(t){l(t)}},n=t=>t.done?e(t.value):Promise.resolve(t.value).then(s,i);n((r=r.apply(t,a)).next())}));var t,a,r}));const y=h((()=>"选择人员"));return{treeRef:d,multiSelect:l,treeData:s,treeLoading:i,registerModal:p,getTitle:y,selectedList:a,removeAllSelected:function(){l.value?c.value=[]:o.value=[]},removeSelectedItem:function(e){l.value?c.value.splice(c.value.findIndex((t=>t===e)),1):o.value.splice(o.value.findIndex((t=>t===e)),1)},handleSubmit:function(){t("success",a),g()},handleCheck:function(e){l.value?c.value=JSON.parse(JSON.stringify(e.checked)):c.value=JSON.parse(JSON.stringify(e.checked.length>0?[e.checked[0]]:[]))},handleSelect:function(e){l.value||(o.value=e)}}}});const D={class:"selected-items"};E.render=function(e,t,a,l,s,r){const i=S("Tag"),n=S("CloseCircleOutlined"),o=S("BasicTree"),c=S("PageWrapper"),d=S("BasicModal"),u=g("loading");return y(),O(d,T({wrapClassName:"selector-body org"},e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:k((()=>[j("div",D,[(y(!0),O(x,null,C(e.selectedList,(t=>(y(),O(i,{color:"processing",closable:"",onClose:a=>{a.preventDefault(),e.removeSelectedItem(t.id)}},{default:k((()=>[N(w(t.shortName),1)])),_:2},1032,["onClose"])))),256)),e.selectedList.length>0?(y(),O(n,{key:0,class:"close-all",title:"清空",onClick:e.removeAllSelected},null,8,["onClick"])):P("",!0)]),j(c,{dense:"",contentClass:"flex"},{default:k((()=>[J(j(o,{ref:"treeRef",class:"w-4/4 org-tree",title:"组织",search:"",clickRowToExpand:!1,treeData:e.treeData,replaceFields:{key:"id",title:"shortName"},onCheck:e.handleCheck,onSelect:e.handleSelect,checkable:!!e.multiSelect,selectable:!e.multiSelect,checkStrictly:!0,autoExpandParent:""},null,8,["treeData","onCheck","onSelect","checkable","selectable"]),[[u,e.treeLoading]])])),_:1})])),_:1},16,["onRegister","title","onOk"])};export default E;
