var j=Object.defineProperty;var y=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var C=(e,a,t)=>a in e?j(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,E=(e,a)=>{for(var t in a||(a={}))L.call(a,t)&&C(e,t,a[t]);if(y)for(var t of y(a))O.call(a,t)&&C(e,t,a[t]);return e};var B=(e,a,t)=>new Promise((n,i)=>{var f=s=>{try{u(t.next(s))}catch(p){i(p)}},d=s=>{try{u(t.throw(s))}catch(p){i(p)}},u=s=>s.done?n(s.value):Promise.resolve(s.value).then(f,d);u((t=t.apply(e,a)).next())});import{B as V,a as G}from"./index.a492e5cd.js";import{B as J}from"./BasicForm.027cbf67.js";import{u as z}from"./useForm.81406efc.js";import{bV as W,eB as H,eU as K,az as Q,a as X,ag as Y,x as v,k as P,h as Z,aB as F,i as D,l as ee,C as h,q as I,j as x,aC as te,fk as oe,fl as ae,H as ue,p as se}from"./index.e61ad282.js";import{T as re}from"./index.6e0a0264.js";import{a as T}from"./jobGrade.d0262e80.js";import{g as M}from"./positionInfo.b3a09244.js";import{g as N}from"./company.adda1c4d.js";import{g as b}from"./dept.ee76c2af.js";import{c as ne,e as le}from"./personal.e4cf03c0.js";import{U as ie}from"./index.6749d186.js";import"./index.114515de.js";import{F as de}from"./constantEnum.bf6653fb.js";import{P as pe}from"./PlusOutlined.e602ccf2.js";const Se=[{title:"\u59D3\u540D",dataIndex:"name",width:120,align:"left"},{title:"\u5DE5\u53F7",dataIndex:"code",width:100,align:"left"},{title:"\u72B6\u6001",dataIndex:"status",width:60,customRender:({record:e})=>{const t=~~e.status===1,n=t?"green":"red",i=t?"\u5728\u804C":"\u79BB\u804C";return W(re,{color:n},()=>i)}},{title:"\u90AE\u7BB1",dataIndex:"email",width:120,align:"left"},{title:"\u624B\u673A",dataIndex:"mobile",width:120,align:"left"},{title:"\u90E8\u95E8",dataIndex:"deptName",width:120,align:"left"},{title:"\u516C\u53F8",dataIndex:"companyName",width:120,align:"left"},{title:"\u4E0A\u7EA7\u9886\u5BFC",dataIndex:"leaderName",width:140,align:"left",customRender:({record:e})=>e.leaderCode?`${e.leaderName||""}[${e.leaderCode}]`:"\u672A\u8BBE\u7F6E"},{title:"\u89D2\u8272",dataIndex:"roles",width:300,align:"left"},{title:"\u79BB\u804C\u65E5\u671F",dataIndex:"leaveDate",width:100,customRender:({text:e})=>e?H(e):""},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createTime",width:130,customRender:({text:e})=>e?K(e):""}],Ue=[{field:"keyword",label:"\u5173\u952E\u5B57",component:"Input",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D/\u5DE5\u53F7/\u624B\u673A/\u90AE\u7BB1"},labelWidth:60,colProps:{span:8,lg:{span:8,offset:0},sm:{span:14,offset:0},xs:{span:16,offset:0}}}],ce=[{field:"id",label:"ID",required:!1,component:"Input",show:!1},{field:"name",label:"\u59D3\u540D",component:"Input",required:!0,colProps:{span:9},rules:[{required:!0,whitespace:!0,message:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A\uFF01"},{max:20,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E20\uFF01"}]},{field:"code",label:"\u5DE5\u53F7",component:"Input",required:!0,colProps:{span:9}},{field:"headImg",label:"",component:"Input",slot:"headImg",colProps:{style:"margin: auto;position: absolute;right: 0;",span:8}},{label:"\u624B\u673A",field:"mobile",component:"Input",required:!0,colProps:{span:9},rules:[{required:!0,whitespace:!0,message:"\u624B\u673A\u4E0D\u80FD\u4E3A\u7A7A\uFF01"},{pattern:new RegExp("^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\\d{8}$"),type:"string",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\uFF01"},{max:32,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E32\uFF01"}]},{label:"\u90AE\u7BB1",field:"email",component:"Input",colProps:{span:9},rules:[{pattern:new RegExp("^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$"),type:"string",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740\uFF01"},{max:256,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E256\uFF01"}]},{field:"sex",label:"\u6027\u522B",component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:"\u7537",value:1},{label:"\u5973",value:2}]},colProps:{span:9}},{field:"status",label:"\u5728\u804C\u72B6\u6001",component:"RadioButtonGroup",defaultValue:1,componentProps:{options:[{label:"\u5728\u804C",value:1},{label:"\u79BB\u804C",value:0}]},colProps:{span:9}},{field:"jobGradeCode",label:"\u804C\u7EA7",component:"ApiTreeSelect",colProps:{span:12},componentProps:{api:T,treeNodeFilterProp:"showName",getPopupContainer:()=>document.body}},{field:"positionCode",label:"\u5C97\u4F4D",component:"ApiTreeSelect",colProps:{span:12},componentProps:{api:M,treeNodeFilterProp:"showName",getPopupContainer:()=>document.body}},{field:"companyId",label:"\u6240\u5C5E\u516C\u53F8",component:"ApiTreeSelect",colProps:{span:12},componentProps:{api:N,treeNodeFilterProp:"cname",getPopupContainer:()=>document.body},required:!0},{field:"deptId",label:"\u6240\u5C5E\u90E8\u95E8",component:"TreeSelect",colProps:{span:12},componentProps:{treeNodeFilterProp:"name",getPopupContainer:()=>document.body},required:!0},{label:"\u5730\u5740",field:"address",component:"InputTextArea",rules:[{max:400,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E400\uFF01"}],colProps:{span:24}}];const me=X({name:"PersonalModal",components:{BasicModal:V,BasicForm:J,PlusOutlined:pe,LoadingOutlined:Y,Upload:ie},emits:["success","register"],setup(e,{emit:a}){const t=v(!0),n=v(""),{createMessage:i}=ue(),[f,{setFieldsValue:d,updateSchema:u,resetFields:s,validate:p}]=z({labelWidth:100,schemas:ce,showActionButtonGroup:!1,actionColOptions:{span:23}}),w=o=>[{trigger:"blur",validator:(m,l)=>l?ne({id:o.id,field:o.field,fieldValue:l,fieldName:o.fieldName}).then(r=>r?Promise.resolve():Promise.reject(o.fieldName+"\u5DF2\u5B58\u5728\uFF0C\u8BF7\u4FEE\u6539\uFF01")).catch(r=>Promise.reject(r)):Promise.resolve()}],[A,{setModalProps:g,closeModal:R,changeLoading:_}]=G(o=>B(this,null,function*(){_(!0),s(),g({confirmLoading:!1}),t.value=!!(o!=null&&o.isUpdate),yield N();const m=yield T(),l=yield M();let r=o.record;if(yield u({field:"companyId",componentProps:{onChange:c=>{u([{field:"deptId",componentProps:{treeData:[]}}]),d({deptId:""}),c&&b({companyId:c}).then($=>{u([{field:"deptId",componentProps:{treeData:$}}])})}}}),yield u([{field:"jobGradeCode",componentProps:{treeData:m}},{field:"positionCode",componentProps:{treeData:l}},{field:"code",dynamicRules:()=>[{required:!0,whitespace:!0,message:"\u5DE5\u53F7\u4E0D\u80FD\u4E3A\u7A7A\uFF01"},{pattern:new RegExp(de.SN),type:"string",message:"\u8BF7\u8F93\u5165\u82F1\u6587\u6216\u6570\u5B57\uFF01"},{max:32,message:"\u5B57\u7B26\u957F\u5EA6\u4E0D\u80FD\u5927\u4E8E32\uFF01"},...w({id:P(t)&&r&&r.id||"",field:"code",fieldValue:"",fieldName:"\u5DE5\u53F7"})]}]),P(t)){const c=yield b({companyId:o.record.companyId});u([{field:"deptId",componentProps:{treeData:c}}]),d(E({},o.record)),n.value=o.record.headImg}else{if(r.companyId){const c=yield b({companyId:r.companyId});u([{field:"deptId",componentProps:{treeData:c}}]),d(E({},r))}n.value=""}_(!1)})),S=Z(()=>P(t)?"\u7F16\u8F91":"\u65B0\u589E"),U=(o,m)=>{const l=new FileReader;l.addEventListener("load",()=>m(l.result)),l.readAsDataURL(o)},k=o=>o.type==="image/jpeg"||o.type==="image/png"?o.size/1024/1024<2?(U(o,r=>{n.value=r}),!1):(i.error("\u56FE\u7247\u4E0D\u80FD\u5927\u4E8E2MB\uFF01"),!1):(i.error("\u53EA\u5141\u8BB8\u4E0A\u4F20JPG\u56FE\u7247\uFF01"),!1);function q(){return B(this,null,function*(){try{g({confirmLoading:!0});const o=yield p();o.headImg=n.value,yield le(o),R(),a("success")}finally{g({confirmLoading:!1})}})}return{registerModal:A,registerForm:f,getTitle:S,imageUrl:n,handleSubmit:q,beforeUpload:k}}}),fe=e=>(oe("data-v-07dded6d"),e=e(),ae(),e),Fe=["src"],ge={key:1},Ee=fe(()=>se("div",{class:"ant-upload-text"},"\u4E0A\u4F20\u5934\u50CF",-1));function Be(e,a,t,n,i,f){const d=F("plus-outlined"),u=F("Upload"),s=F("BasicForm"),p=F("BasicModal");return D(),ee(p,te(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:h(()=>[I(s,{onRegister:e.registerForm,class:"personalForm"},{headImg:h(({model:w,field:A})=>[I(u,{style:{margin:"auto"},name:"avatar","list-type":"picture-card",class:"avatar-uploader","show-upload-list":!1,"before-upload":e.beforeUpload,multiple:!1},{default:h(()=>[e.imageUrl?(D(),x("img",{key:0,src:e.imageUrl,alt:"avatar"},null,8,Fe)):(D(),x("div",ge,[I(d),Ee]))]),_:1},8,["before-upload"])]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title","onOk"])}var Pe=Q(me,[["render",Be],["__scopeId","data-v-07dded6d"]]),ke=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Pe});export{Pe as P,ke as a,Se as c,Ue as s};
