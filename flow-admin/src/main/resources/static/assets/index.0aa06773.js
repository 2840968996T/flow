var I=Object.defineProperty;var b=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var w=(e,a,t)=>a in e?I(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,C=(e,a)=>{for(var t in a||(a={}))R.call(a,t)&&w(e,t,a[t]);if(b)for(var t of b(a))V.call(a,t)&&w(e,t,a[t]);return e};var J=(e,a,t)=>new Promise((i,d)=>{var v=c=>{try{r(t.next(c))}catch(o){d(o)}},n=c=>{try{r(t.throw(c))}catch(o){d(o)}},r=c=>c.done?i(c.value):Promise.resolve(c.value).then(v,n);r((t=t.apply(e,a)).next())});import{B as F,a as W}from"./index.1f9d3a9d.js";import{P as x}from"./index.fe38133b.js";import{az as j,a as z,b4 as q,e6 as G,w as f,a9 as K,fE as O,an as T,h as H,aB as g,bS as Q,o as k,k as B,B as E,n as U,i as X,F as Y,aE as Z,C as ee,t as te,l as le,p as D,y as se,aC as ae,j as re}from"./index.97f55544.js";import{T as oe}from"./index.8e778cab.js";import{a as ie}from"./dept.77a8a079.js";import{_ as ne}from"./index.8cd44c0f.js";import"./useWindowSizeFn.61edac1b.js";import"./FullscreenOutlined.b5079cb0.js";import"./index.b145dae6.js";import"./index.a43619a6.js";import"./useSize.eb64bd2e.js";import"./eagerComputed.009c9352.js";import"./useContentViewHeight.f7978643.js";import"./ArrowLeftOutlined.cdba934c.js";import"./index.73fcc7b5.js";import"./transButton.76d507e2.js";import"./fromPairs.84aabb58.js";import"./index.2043c4f4.js";import"./useContextMenu.a6e3d036.js";import"./index.4592027a.js";import"./get.d05ccbd6.js";const ce=z({props:{title:{type:String,default:"\u4EBA\u5458\u9009\u62E9"}},name:"OrgSelector",components:{BasicModal:F,PageWrapper:x,Tag:oe,BasicTree:ne,Spin:q,CloseCircleOutlined:G},setup(e,{emit:a}){const t=f([]),i=f(!1),d=f([]),v=f(!1),n=f([]),r=f([]),c=f(null);function o(){const l=re(c);if(!l)throw new Error("tree is null!");return l}K(r,(l,u)=>{if(i.value){const m=l.map(p=>{let s=O(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return s=C({},s),delete s.children,s});T(()=>{t.value=JSON.parse(JSON.stringify(m)),o().setCheckedKeys(l)})}else{const m=l.map(p=>{let s=O(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return s=C({},s),delete s.children,s});T(()=>{t.value=JSON.parse(JSON.stringify(m)),o().setSelectedKeys(l)})}},{immediate:!0,deep:!0}),K(n,(l,u)=>{if(!i.value){const m=l.map(p=>{let s=O(d.value,h=>h.id===p,{id:"id",pid:"pid",children:"children"});return s=C({},s),delete s.children,s});T(()=>{t.value=JSON.parse(JSON.stringify(m)),o().setSelectedKeys(l)})}},{immediate:!0,deep:!0});const[y,{setModalProps:_,closeModal:S}]=W(l=>J(this,null,function*(){const{selectorProps:u}=l;v.value=!0,i.value=u.multiSelect,ie().then(m=>{d.value=m,u.selectedList;let p=u.selectedList.map(s=>s.id);i.value?(r.value=p,setTimeout(()=>{o().setCheckedKeys(r.value),o().setExpandedKeys(r.value)},200)):(n.value=p,setTimeout(()=>{o().setSelectedKeys(n.value),o().setExpandedKeys(n.value)},200))}).finally(()=>{v.value=!1}),_({wrapClassName:"selector-content"})}));function N(l){i.value?r.value=JSON.parse(JSON.stringify(l.checked)):r.value=JSON.parse(JSON.stringify(l.checked.length>0?[l.checked[0]]:[]))}function L(l){if(!i.value)n.value=l;else debugger}const M=H(()=>"\u9009\u62E9\u4EBA\u5458");function P(){i.value?r.value=[]:n.value=[]}function A(l){i.value?r.value.splice(r.value.findIndex(u=>u===l),1):n.value.splice(n.value.findIndex(u=>u===l),1)}function $(){a("success",t),S()}return{treeRef:c,multiSelect:i,treeData:d,treeLoading:v,registerModal:y,getTitle:M,selectedList:t,removeAllSelected:P,removeSelectedItem:A,handleSubmit:$,handleCheck:N,handleSelect:L}}}),de={class:"selected-items"};function ue(e,a,t,i,d,v){const n=g("Tag"),r=g("CloseCircleOutlined"),c=g("BasicTree"),o=g("PageWrapper"),y=g("BasicModal"),_=Q("loading");return k(),B(y,ae({wrapClassName:"selector-body org"},e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:E(()=>[U("div",de,[(k(!0),X(Y,null,Z(e.selectedList,S=>(k(),B(n,{color:"processing",closable:"",onClose:N=>{N.preventDefault(),e.removeSelectedItem(S.id)}},{default:E(()=>[ee(te(S.shortName),1)]),_:2},1032,["onClose"]))),256)),e.selectedList.length>0?(k(),B(r,{key:0,class:"close-all",title:"\u6E05\u7A7A",onClick:e.removeAllSelected},null,8,["onClick"])):le("",!0)]),D(o,{dense:"",contentClass:"flex"},{default:E(()=>[se(D(c,{ref:"treeRef",class:"w-4/4 org-tree",title:"\u7EC4\u7EC7",search:"",clickRowToExpand:!1,treeData:e.treeData,replaceFields:{key:"id",title:"shortName"},onCheck:e.handleCheck,onSelect:e.handleSelect,checkable:!!e.multiSelect,selectable:!e.multiSelect,checkStrictly:!0,autoExpandParent:""},null,8,["treeData","onCheck","onSelect","checkable","selectable"]),[[_,e.treeLoading]])]),_:1})]),_:1},16,["onRegister","title","onOk"])}var Me=j(ce,[["render",ue]]);export{Me as default};
